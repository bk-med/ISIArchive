{"ast":null,"code":"import _objectSpread from\"/Users/brahimkhalilkhalef/Projects/ISIArchive/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useParams,useNavigate}from'react-router-dom';import{motion}from'framer-motion';import{ArrowLeft,Download,FileText,Calendar,User,BookOpen,GraduationCap,Star,FileIcon,CheckCircle,Plus,Trash2}from'lucide-react';import{useAuth}from'../../contexts/AuthContext';import{documentsAPI}from'../../utils/api';import toast from'react-hot-toast';import{CorrectionUploadModal}from'../../components/forms/CorrectionUploadModal';import Modal from'../../components/ui/Modal';import Button from'../../components/ui/Button';import CommentSection from'../../components/ui/CommentSection';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DocumentDetails=()=>{var _document$_count;const{id}=useParams();const navigate=useNavigate();const{user}=useAuth();const[document,setDocument]=useState(null);const[loading,setLoading]=useState(true);const[showCorrectionModal,setShowCorrectionModal]=useState(false);const[showDeleteModal,setShowDeleteModal]=useState(false);const fetchingRef=useRef(false);// Animation variants matching Dashboard\nconst containerVariants={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:0.05,delayChildren:0.1}}};const itemVariants={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:0.3,ease:\"easeOut\"}}};const cardVariants={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:0.4,ease:\"easeOut\"}},hover:{y:-2,transition:{duration:0.2,ease:'easeOut'}}};useEffect(()=>{if(id&&!fetchingRef.current){fetchDocument();}},[id]);const fetchDocument=async()=>{if(fetchingRef.current){return;// Prevent multiple simultaneous calls\n}try{fetchingRef.current=true;setLoading(true);const response=await documentsAPI.getDocumentById(id);// Map the backend response to match frontend expectations\nconst documentData=_objectSpread(_objectSpread({},response.data),{},{pfeData:response.data.documentPFE// Map documentPFE to pfeData\n});setDocument(documentData);}catch(error){console.error('Error fetching document:',error);toast.error('Erreur lors du chargement du document');navigate('/documents');}finally{setLoading(false);fetchingRef.current=false;}};const handleDownload=async doc=>{try{const blob=await documentsAPI.downloadDocument(doc.id);const url=window.URL.createObjectURL(blob);const link=window.document.createElement('a');link.href=url;link.download=doc.nomFichier;window.document.body.appendChild(link);link.click();window.document.body.removeChild(link);window.URL.revokeObjectURL(url);toast.success('Document téléchargé avec succès');}catch(error){console.error('Error downloading document:',error);toast.error('Erreur lors du téléchargement');}};const handleCorrectionUploadSuccess=()=>{setShowCorrectionModal(false);fetchDocument();// Refresh document data\ntoast.success('Correction ajoutée avec succès');};const handleDeleteDocument=async()=>{if(!document)return;try{await documentsAPI.deleteDocument(document.id);toast.success('Document supprimé avec succès');navigate('/documents');// Redirect to documents list\n}catch(error){console.error('Error deleting document:',error);toast.error('Erreur lors de la suppression du document');}};const canAddCorrection=doc=>{// Only professors and admins can add corrections\nif((user===null||user===void 0?void 0:user.role)!=='professeur'&&(user===null||user===void 0?void 0:user.role)!=='admin')return false;// Can't add correction to PFE documents or documents that already have corrections\nif(doc.categorie==='pfe'||doc.correction||doc.correctionId)return false;return true;};const canDeleteDocument=doc=>{// Only document owner or admin can delete\nreturn(user===null||user===void 0?void 0:user.role)==='admin'||doc.uploader.id===(user===null||user===void 0?void 0:user.id);};const formatFileSize=bytes=>{const size=parseInt(bytes);if(size===0)return'0 B';const k=1024;const sizes=['B','KB','MB','GB'];const i=Math.floor(Math.log(size)/Math.log(k));return parseFloat((size/Math.pow(k,i)).toFixed(2))+' '+sizes[i];};const getCategoryIcon=categorie=>{switch(categorie){case'cours':return BookOpen;case'td':return FileText;case'tp':return FileIcon;case'examen':return Calendar;case'correction':return Star;case'pfe':return GraduationCap;default:return FileText;}};const getCategoryColor=categorie=>{switch(categorie){case'cours':return'bg-blue-100 text-blue-800 border-blue-200';case'td':return'bg-green-100 text-green-800 border-green-200';case'tp':return'bg-purple-100 text-purple-800 border-purple-200';case'examen':return'bg-red-100 text-red-800 border-red-200';case'correction':return'bg-yellow-100 text-yellow-800 border-yellow-200';case'pfe':return'bg-indigo-100 text-indigo-800 border-indigo-200';default:return'bg-gray-100 text-gray-800 border-gray-200';}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(motion.div,{className:\"flex flex-col items-center space-y-4\",initial:{opacity:0,scale:0.8},animate:{opacity:1,scale:1},transition:{duration:0.5},children:[/*#__PURE__*/_jsx(motion.div,{className:\"w-16 h-16 border-4 border-primary-200 border-t-primary-600 rounded-full\",animate:{rotate:360},transition:{duration:1,repeat:Infinity,ease:'linear'}}),/*#__PURE__*/_jsx(motion.p,{className:\"text-secondary-600 font-medium\",animate:{opacity:[0.5,1,0.5]},transition:{duration:1.5,repeat:Infinity},children:\"Chargement du document...\"})]})});}if(!document){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-2\",children:\"Document non trouv\\xE9\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"Le document demand\\xE9 n'existe pas ou vous n'avez pas les permissions pour y acc\\xE9der.\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/documents'),className:\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\",children:[/*#__PURE__*/_jsx(ArrowLeft,{className:\"w-4 h-4 mr-2\"}),\"Retour aux documents\"]})]})});}const CategoryIcon=getCategoryIcon(document.categorie);// Debug log to check if we reach the render\nconsole.log('Rendering DocumentDetails with document:',document===null||document===void 0?void 0:document.titre);return/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/documents'),className:\"inline-flex items-center text-sm text-gray-500 hover:text-gray-700 mb-4\",children:[/*#__PURE__*/_jsx(ArrowLeft,{className:\"w-4 h-4 mr-1\"}),\"Retour aux documents\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-start justify-between\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-white rounded-lg shadow-sm border\",children:/*#__PURE__*/_jsx(CategoryIcon,{className:\"w-8 h-8 text-gray-600\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900 mb-2\",children:document.titre}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border \".concat(getCategoryColor(document.categorie)),children:document.categorie.toUpperCase()}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-500\",children:[\"Ajout\\xE9 le \",new Date(document.createdAt).toLocaleDateString('fr-FR')]})]})]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 space-y-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border p-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 mb-4\",children:\"Informations du document\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[document.description&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Description\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:document.description})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Auteur\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(User,{className:\"w-4 h-4 text-gray-400\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600\",children:[document.uploader.prenom,\" \",document.uploader.nom]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Taille du fichier\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:formatFileSize(document.tailleFichier)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Type de fichier\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:document.typeMime})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Date d'ajout\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:new Date(document.createdAt).toLocaleDateString('fr-FR',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})})]})]}),document.matiere&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Mati\\xE8re\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-600\",children:[document.matiere.nom,\" (\",document.matiere.code,\")\"]})]}),document.pfeData&&/*#__PURE__*/_jsxs(\"div\",{className:\"border-t pt-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-3\",children:\"Informations PFE\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Titre du projet\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:document.pfeData.titreProjet})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Ann\\xE9e de dipl\\xF4me\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:document.pfeData.anneeDiplome})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"Fili\\xE8re de dipl\\xF4me\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:document.pfeData.filiereDiplome})]})]}),document.pfeData.resume&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-1\",children:\"R\\xE9sum\\xE9\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:document.pfeData.resume})]}),document.pfeData.motsCles.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-700 mb-2\",children:\"Mots-cl\\xE9s\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2\",children:document.pfeData.motsCles.map((tag,index)=>/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\",children:tag},index))})]})]})]})]})]}),document.correction&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 rounded-lg border border-blue-200 p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-4\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-5 h-5 text-blue-600\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-blue-900\",children:\"Correction disponible\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-blue-900 mb-1\",children:\"Titre\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-800\",children:document.correction.titre})]}),document.correction.description&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-blue-900 mb-1\",children:\"Description\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-blue-800\",children:document.correction.description})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-blue-900 mb-1\",children:\"Taille\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-800\",children:formatFileSize(document.correction.tailleFichier)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-blue-900 mb-1\",children:\"Ajout\\xE9e le\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-800\",children:new Date(document.correction.createdAt).toLocaleDateString('fr-FR')})]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleDownload(document.correction),className:\"inline-flex items-center px-4 py-2 text-sm font-medium text-blue-700 bg-blue-100 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\",children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 mr-2\"}),\"T\\xE9l\\xE9charger la correction\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border p-6\",children:/*#__PURE__*/_jsx(CommentSection,{documentId:document.id})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Actions rapides\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleDownload(document),className:\"w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\",children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 mr-2\"}),\"T\\xE9l\\xE9charger le document\"]}),document.correction&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleDownload(document.correction),className:\"w-full inline-flex items-center justify-center px-4 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100\",children:[/*#__PURE__*/_jsx(Download,{className:\"w-4 h-4 mr-2\"}),\"T\\xE9l\\xE9charger la correction\"]}),canAddCorrection(document)&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowCorrectionModal(true),className:\"w-full inline-flex items-center justify-center px-4 py-2 border border-green-300 text-sm font-medium rounded-md text-green-700 bg-green-50 hover:bg-green-100\",children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Ajouter une correction\"]}),canDeleteDocument(document)&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowDeleteModal(true),className:\"w-full inline-flex items-center justify-center px-4 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100\",children:[/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4 mr-2\"}),\"Supprimer le document\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Statistiques\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"T\\xE9l\\xE9chargements\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-900\",children:document.downloadCount||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"Commentaires\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-900\",children:((_document$_count=document._count)===null||_document$_count===void 0?void 0:_document$_count.commentaires)||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"Vues\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm font-medium text-gray-900\",children:document.viewCount||0})]})]})]})]})]})]}),showCorrectionModal&&document&&/*#__PURE__*/_jsx(CorrectionUploadModal,{isOpen:showCorrectionModal,onClose:()=>setShowCorrectionModal(false),parentDocumentId:document.id,parentDocumentTitle:document.titre,onSuccess:handleCorrectionUploadSuccess}),/*#__PURE__*/_jsx(Modal,{isOpen:showDeleteModal,onClose:()=>setShowDeleteModal(false),title:\"Confirmer la suppression\",children:document&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-secondary-600\",children:[\"\\xCAtes-vous s\\xFBr de vouloir supprimer le document\",' ',/*#__PURE__*/_jsx(\"strong\",{children:document.titre}),\" ?\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-amber-600\",children:\"Le document sera d\\xE9plac\\xE9 vers la corbeille et pourra \\xEAtre r\\xE9cup\\xE9r\\xE9 pendant 30 jours.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-end gap-3\",children:[/*#__PURE__*/_jsx(Button,{variant:\"outline\",onClick:()=>setShowDeleteModal(false),children:\"Annuler\"}),/*#__PURE__*/_jsx(Button,{variant:\"danger\",onClick:handleDeleteDocument,children:\"Supprimer\"})]})]})})]});};export default DocumentDetails;","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","motion","ArrowLeft","Download","FileText","Calendar","User","BookOpen","GraduationCap","Star","FileIcon","CheckCircle","Plus","Trash2","useAuth","documentsAPI","toast","CorrectionUploadModal","Modal","Button","CommentSection","jsx","_jsx","jsxs","_jsxs","DocumentDetails","_document$_count","id","navigate","user","document","setDocument","loading","setLoading","showCorrectionModal","setShowCorrectionModal","showDeleteModal","setShowDeleteModal","fetchingRef","containerVariants","hidden","opacity","visible","transition","staggerChildren","delayChildren","itemVariants","y","duration","ease","cardVariants","hover","current","fetchDocument","response","getDocumentById","documentData","_objectSpread","data","pfeData","documentPFE","error","console","handleDownload","doc","blob","downloadDocument","url","window","URL","createObjectURL","link","createElement","href","download","nomFichier","body","appendChild","click","removeChild","revokeObjectURL","success","handleCorrectionUploadSuccess","handleDeleteDocument","deleteDocument","canAddCorrection","role","categorie","correction","correctionId","canDeleteDocument","uploader","formatFileSize","bytes","size","parseInt","k","sizes","i","Math","floor","log","parseFloat","pow","toFixed","getCategoryIcon","getCategoryColor","className","children","div","initial","scale","animate","rotate","repeat","Infinity","p","onClick","CategoryIcon","titre","concat","toUpperCase","Date","createdAt","toLocaleDateString","description","prenom","nom","tailleFichier","typeMime","year","month","day","hour","minute","matiere","code","titreProjet","anneeDiplome","filiereDiplome","resume","motsCles","length","map","tag","index","documentId","downloadCount","_count","commentaires","viewCount","isOpen","onClose","parentDocumentId","parentDocumentTitle","onSuccess","title","variant"],"sources":["/Users/brahimkhalilkhalef/Projects/ISIArchive/frontend/src/pages/dashboard/DocumentDetails.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { motion } from 'framer-motion';\nimport {\n  ArrowLeft,\n  Download,\n  FileText,\n  Calendar,\n  User,\n  BookOpen,\n  GraduationCap,\n  Star,\n  FileIcon,\n  CheckCircle,\n  FileCheck,\n  MessageCircle,\n  Loader2,\n  Upload,\n  Plus,\n  Trash2,\n  Edit\n} from 'lucide-react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { documentsAPI } from '../../utils/api';\nimport { Document } from '../../types';\nimport toast from 'react-hot-toast';\nimport { CorrectionUploadModal } from '../../components/forms/CorrectionUploadModal';\nimport Modal from '../../components/ui/Modal';\nimport Button from '../../components/ui/Button';\nimport CommentSection from '../../components/ui/CommentSection';\n\nconst DocumentDetails: React.FC = () => {\n  const { id } = useParams<{ id: string }>();\n  const navigate = useNavigate();\n  const { user } = useAuth();\n  const [document, setDocument] = useState<Document | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [showCorrectionModal, setShowCorrectionModal] = useState(false);\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\n  const fetchingRef = useRef(false);\n\n  // Animation variants matching Dashboard\n  const containerVariants = {\n    hidden: { opacity: 0 },\n    visible: {\n      opacity: 1,\n      transition: {\n        staggerChildren: 0.05,\n        delayChildren: 0.1,\n      },\n    },\n  };\n\n  const itemVariants = {\n    hidden: { opacity: 0, y: 10 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: {\n        duration: 0.3,\n        ease: \"easeOut\",\n      },\n    },\n  };\n\n  const cardVariants = {\n    hidden: { opacity: 0, y: 20 },\n    visible: {\n      opacity: 1,\n      y: 0,\n      transition: {\n        duration: 0.4,\n        ease: \"easeOut\",\n      },\n    },\n    hover: {\n      y: -2,\n      transition: {\n        duration: 0.2,\n        ease: 'easeOut',\n      },\n    },\n  };\n\n  useEffect(() => {\n    if (id && !fetchingRef.current) {\n      fetchDocument();\n    }\n  }, [id]);\n\n  const fetchDocument = async () => {\n    if (fetchingRef.current) {\n      return; // Prevent multiple simultaneous calls\n    }\n\n    try {\n      fetchingRef.current = true;\n      setLoading(true);\n      const response = await documentsAPI.getDocumentById(id!);\n      \n      // Map the backend response to match frontend expectations\n      const documentData = {\n        ...response.data,\n        pfeData: response.data.documentPFE // Map documentPFE to pfeData\n      };\n      \n      setDocument(documentData);\n    } catch (error: any) {\n      console.error('Error fetching document:', error);\n      toast.error('Erreur lors du chargement du document');\n      navigate('/documents');\n    } finally {\n      setLoading(false);\n      fetchingRef.current = false;\n    }\n  };\n\n  const handleDownload = async (doc: Document) => {\n    try {\n      const blob = await documentsAPI.downloadDocument(doc.id);\n      const url = window.URL.createObjectURL(blob);\n      const link = window.document.createElement('a');\n      link.href = url;\n      link.download = doc.nomFichier;\n      window.document.body.appendChild(link);\n      link.click();\n      window.document.body.removeChild(link);\n      window.URL.revokeObjectURL(url);\n      toast.success('Document téléchargé avec succès');\n    } catch (error) {\n      console.error('Error downloading document:', error);\n      toast.error('Erreur lors du téléchargement');\n    }\n  };\n\n  const handleCorrectionUploadSuccess = () => {\n    setShowCorrectionModal(false);\n    fetchDocument(); // Refresh document data\n    toast.success('Correction ajoutée avec succès');\n  };\n\n  const handleDeleteDocument = async () => {\n    if (!document) return;\n\n    try {\n      await documentsAPI.deleteDocument(document.id);\n      toast.success('Document supprimé avec succès');\n      navigate('/documents'); // Redirect to documents list\n    } catch (error) {\n      console.error('Error deleting document:', error);\n      toast.error('Erreur lors de la suppression du document');\n    }\n  };\n\n  const canAddCorrection = (doc: Document) => {\n    // Only professors and admins can add corrections\n    if (user?.role !== 'professeur' && user?.role !== 'admin') return false;\n    \n    // Can't add correction to PFE documents or documents that already have corrections\n    if (doc.categorie === 'pfe' || doc.correction || doc.correctionId) return false;\n    \n    return true;\n  };\n\n  const canDeleteDocument = (doc: Document) => {\n    // Only document owner or admin can delete\n    return user?.role === 'admin' || doc.uploader.id === user?.id;\n  };\n\n  const formatFileSize = (bytes: string) => {\n    const size = parseInt(bytes);\n    if (size === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(size) / Math.log(k));\n    return parseFloat((size / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const getCategoryIcon = (categorie: string) => {\n    switch (categorie) {\n      case 'cours': return BookOpen;\n      case 'td': return FileText;\n      case 'tp': return FileIcon;\n      case 'examen': return Calendar;\n      case 'correction': return Star;\n      case 'pfe': return GraduationCap;\n      default: return FileText;\n    }\n  };\n\n  const getCategoryColor = (categorie: string) => {\n    switch (categorie) {\n      case 'cours': return 'bg-blue-100 text-blue-800 border-blue-200';\n      case 'td': return 'bg-green-100 text-green-800 border-green-200';\n      case 'tp': return 'bg-purple-100 text-purple-800 border-purple-200';\n      case 'examen': return 'bg-red-100 text-red-800 border-red-200';\n      case 'correction': return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      case 'pfe': return 'bg-indigo-100 text-indigo-800 border-indigo-200';\n      default: return 'bg-gray-100 text-gray-800 border-gray-200';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <motion.div\n          className=\"flex flex-col items-center space-y-4\"\n          initial={{ opacity: 0, scale: 0.8 }}\n          animate={{ opacity: 1, scale: 1 }}\n          transition={{ duration: 0.5 }}\n        >\n          <motion.div\n            className=\"w-16 h-16 border-4 border-primary-200 border-t-primary-600 rounded-full\"\n            animate={{ rotate: 360 }}\n            transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}\n          />\n          <motion.p\n            className=\"text-secondary-600 font-medium\"\n            animate={{ opacity: [0.5, 1, 0.5] }}\n            transition={{ duration: 1.5, repeat: Infinity }}\n          >\n            Chargement du document...\n          </motion.p>\n        </motion.div>\n      </div>\n    );\n  }\n\n  if (!document) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Document non trouvé</h2>\n          <p className=\"text-gray-600 mb-4\">Le document demandé n'existe pas ou vous n'avez pas les permissions pour y accéder.</p>\n          <button\n            onClick={() => navigate('/documents')}\n            className=\"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Retour aux documents\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  const CategoryIcon = getCategoryIcon(document.categorie);\n\n  // Debug log to check if we reach the render\n  console.log('Rendering DocumentDetails with document:', document?.titre);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div \n        className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\"\n      >\n        {/* Header */}\n        <div \n          className=\"mb-8\"\n        >\n          <button\n            onClick={() => navigate('/documents')}\n            className=\"inline-flex items-center text-sm text-gray-500 hover:text-gray-700 mb-4\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-1\" />\n            Retour aux documents\n          </button>\n          \n          <div className=\"flex items-start justify-between\">\n            <div className=\"flex items-start space-x-4\">\n              <div \n                className=\"p-3 bg-white rounded-lg shadow-sm border\"\n              >\n                <CategoryIcon className=\"w-8 h-8 text-gray-600\" />\n              </div>\n              <div>\n                <h1 \n                  className=\"text-3xl font-bold text-gray-900 mb-2\"\n                >\n                  {document.titre}\n                </h1>\n                <div \n                  className=\"flex items-center space-x-4\"\n                >\n                  <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${getCategoryColor(document.categorie)}`}>\n                    {document.categorie.toUpperCase()}\n                  </span>\n                  <span className=\"text-sm text-gray-500\">\n                    Ajouté le {new Date(document.createdAt).toLocaleDateString('fr-FR')}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n          {/* Main Content */}\n          <div className=\"lg:col-span-2 space-y-8\">\n            {/* Document Information */}\n            <div\n              className=\"bg-white rounded-lg shadow-sm border p-6\"\n            >\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Informations du document</h2>\n              \n              <div className=\"space-y-4\">\n                {document.description && (\n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Description</h3>\n                    <p className=\"text-gray-600\">{document.description}</p>\n                  </div>\n                )}\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Auteur</h3>\n                    <div className=\"flex items-center space-x-2\">\n                      <User className=\"w-4 h-4 text-gray-400\" />\n                      <span className=\"text-gray-600\">\n                        {document.uploader.prenom} {document.uploader.nom}\n                      </span>\n                    </div>\n                  </div>\n                  \n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Taille du fichier</h3>\n                    <span className=\"text-gray-600\">{formatFileSize(document.tailleFichier)}</span>\n                  </div>\n                  \n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Type de fichier</h3>\n                    <span className=\"text-gray-600\">{document.typeMime}</span>\n                  </div>\n                  \n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Date d'ajout</h3>\n                    <span className=\"text-gray-600\">\n                      {new Date(document.createdAt).toLocaleDateString('fr-FR', {\n                        year: 'numeric',\n                        month: 'long',\n                        day: 'numeric',\n                        hour: '2-digit',\n                        minute: '2-digit'\n                      })}\n                    </span>\n                  </div>\n                </div>\n\n                {document.matiere && (\n                  <div>\n                    <h3 className=\"text-sm font-medium text-gray-700 mb-1\">Matière</h3>\n                    <span className=\"text-gray-600\">\n                      {document.matiere.nom} ({document.matiere.code})\n                    </span>\n                  </div>\n                )}\n\n                {/* PFE Information */}\n                {document.pfeData && (\n                  <div className=\"border-t pt-4\">\n                    <h3 className=\"text-lg font-medium text-gray-900 mb-3\">Informations PFE</h3>\n                    <div className=\"space-y-3\">\n                      <div>\n                        <h4 className=\"text-sm font-medium text-gray-700 mb-1\">Titre du projet</h4>\n                        <p className=\"text-gray-600\">{document.pfeData.titreProjet}</p>\n                      </div>\n                      \n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <h4 className=\"text-sm font-medium text-gray-700 mb-1\">Année de diplôme</h4>\n                          <span className=\"text-gray-600\">{document.pfeData.anneeDiplome}</span>\n                        </div>\n                        <div>\n                          <h4 className=\"text-sm font-medium text-gray-700 mb-1\">Filière de diplôme</h4>\n                          <span className=\"text-gray-600\">{document.pfeData.filiereDiplome}</span>\n                        </div>\n                      </div>\n                      \n                      {document.pfeData.resume && (\n                        <div>\n                          <h4 className=\"text-sm font-medium text-gray-700 mb-1\">Résumé</h4>\n                          <p className=\"text-gray-600\">{document.pfeData.resume}</p>\n                        </div>\n                      )}\n                      \n                      {document.pfeData.motsCles.length > 0 && (\n                        <div>\n                          <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Mots-clés</h4>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {document.pfeData.motsCles.map((tag, index) => (\n                              <span\n                                key={index}\n                                className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800\"\n                              >\n                                {tag}\n                              </span>\n                            ))}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            {/* Correction Information */}\n            {document.correction && (\n              <div\n                className=\"bg-blue-50 rounded-lg border border-blue-200 p-6\"\n              >\n                <div className=\"flex items-center space-x-2 mb-4\">\n                  <CheckCircle className=\"w-5 h-5 text-blue-600\" />\n                  <h2 className=\"text-xl font-semibold text-blue-900\">Correction disponible</h2>\n                </div>\n                \n                <div className=\"space-y-4\">\n                  <div>\n                    <h3 className=\"text-sm font-medium text-blue-900 mb-1\">Titre</h3>\n                    <p className=\"text-blue-800\">{document.correction.titre}</p>\n                  </div>\n                  \n                  {document.correction.description && (\n                    <div>\n                      <h3 className=\"text-sm font-medium text-blue-900 mb-1\">Description</h3>\n                      <p className=\"text-blue-800\">{document.correction.description}</p>\n                    </div>\n                  )}\n                  \n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <h3 className=\"text-sm font-medium text-blue-900 mb-1\">Taille</h3>\n                      <span className=\"text-blue-800\">{formatFileSize(document.correction.tailleFichier)}</span>\n                    </div>\n                    <div>\n                      <h3 className=\"text-sm font-medium text-blue-900 mb-1\">Ajoutée le</h3>\n                      <span className=\"text-blue-800\">\n                        {new Date(document.correction.createdAt).toLocaleDateString('fr-FR')}\n                      </span>\n                    </div>\n                  </div>\n                  \n                  <button\n                    onClick={() => handleDownload(document.correction!)}\n                    className=\"inline-flex items-center px-4 py-2 text-sm font-medium text-blue-700 bg-blue-100 border border-blue-300 rounded-md hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500\"\n                  >\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Télécharger la correction\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Comments Section */}\n            <div\n              className=\"bg-white rounded-lg shadow-sm border p-6\"\n            >\n              <CommentSection documentId={document.id} />\n            </div>\n          </div>\n\n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Quick Actions */}\n            <div\n              className=\"bg-white rounded-lg shadow-sm border p-6\"\n            >\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Actions rapides</h3>\n              <div className=\"space-y-3\">\n                <button\n                  onClick={() => handleDownload(document)}\n                  className=\"w-full inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700\"\n                >\n                  <Download className=\"w-4 h-4 mr-2\" />\n                  Télécharger le document\n                </button>\n                \n                {document.correction && (\n                  <button\n                    onClick={() => handleDownload(document.correction!)}\n                    className=\"w-full inline-flex items-center justify-center px-4 py-2 border border-blue-300 text-sm font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100\"\n                  >\n                    <Download className=\"w-4 h-4 mr-2\" />\n                    Télécharger la correction\n                  </button>\n                )}\n                \n                {canAddCorrection(document) && (\n                  <button\n                    onClick={() => setShowCorrectionModal(true)}\n                    className=\"w-full inline-flex items-center justify-center px-4 py-2 border border-green-300 text-sm font-medium rounded-md text-green-700 bg-green-50 hover:bg-green-100\"\n                  >\n                    <Plus className=\"w-4 h-4 mr-2\" />\n                    Ajouter une correction\n                  </button>\n                )}\n\n                {canDeleteDocument(document) && (\n                  <button\n                    onClick={() => setShowDeleteModal(true)}\n                    className=\"w-full inline-flex items-center justify-center px-4 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-red-50 hover:bg-red-100\"\n                  >\n                    <Trash2 className=\"w-4 h-4 mr-2\" />\n                    Supprimer le document\n                  </button>\n                )}\n              </div>\n            </div>\n\n            {/* Document Stats */}\n            <div\n              className=\"bg-white rounded-lg shadow-sm border p-6\"\n            >\n              <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Statistiques</h3>\n              <div className=\"space-y-3\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">Téléchargements</span>\n                  <span className=\"text-sm font-medium text-gray-900\">\n                    {document.downloadCount || 0}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">Commentaires</span>\n                  <span className=\"text-sm font-medium text-gray-900\">\n                    {document._count?.commentaires || 0}\n                  </span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-sm text-gray-600\">Vues</span>\n                  <span className=\"text-sm font-medium text-gray-900\">\n                    {document.viewCount || 0}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Correction Upload Modal */}\n      {showCorrectionModal && document && (\n        <CorrectionUploadModal\n          isOpen={showCorrectionModal}\n          onClose={() => setShowCorrectionModal(false)}\n          parentDocumentId={document.id}\n          parentDocumentTitle={document.titre}\n          onSuccess={handleCorrectionUploadSuccess}\n        />\n      )}\n\n      {/* Delete Confirmation Modal */}\n      <Modal\n        isOpen={showDeleteModal}\n        onClose={() => setShowDeleteModal(false)}\n        title=\"Confirmer la suppression\"\n      >\n        {document && (\n          <div className=\"space-y-4\">\n            <p className=\"text-secondary-600\">\n              Êtes-vous sûr de vouloir supprimer le document{' '}\n              <strong>{document.titre}</strong> ?\n            </p>\n            <p className=\"text-sm text-amber-600\">\n              Le document sera déplacé vers la corbeille et pourra être récupéré pendant 30 jours.\n            </p>\n            <div className=\"flex justify-end gap-3\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setShowDeleteModal(false)}\n              >\n                Annuler\n              </Button>\n              <Button\n                variant=\"danger\"\n                onClick={handleDeleteDocument}\n              >\n                Supprimer\n              </Button>\n            </div>\n          </div>\n        )}\n      </Modal>\n    </div>\n  );\n};\n\nexport default DocumentDetails; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}