{"ast":null,"code":"import _objectSpread from\"/Users/brahimkhalilkhalef/Projects/ISIArchive/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{motion,AnimatePresence}from'framer-motion';import{X,Upload,FileText,AlertCircle,CheckCircle,Loader2,BookOpen,GraduationCap}from'lucide-react';import{useAuth}from'../../contexts/AuthContext';import{documentsAPI,academicAPI}from'../../utils/api';import toast from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const DocumentUploadModal=_ref=>{var _semestres$find;let{isOpen,onClose,onSuccess,preselectedMatiereId}=_ref;const{user}=useAuth();const[loading,setLoading]=useState(false);const[uploadType,setUploadType]=useState('document');const[niveaux,setNiveaux]=useState([]);const[filieres,setFilieres]=useState([]);const[semestres,setSemestres]=useState([]);const[matieres,setMatieres]=useState([]);const[professorMatieres,setProfessorMatieres]=useState([]);const[preselectedMatiere,setPreselectedMatiere]=useState(null);const[formData,setFormData]=useState({titre:'',description:'',categorie:'',matiereId:'',selectedMatiereIds:[],niveauId:'',filiereId:'',semestreId:'',// PFE specific fields\nanneeDiplome:new Date().getFullYear(),resume:'',motsCles:'',file:null});const[errors,setErrors]=useState({});const[isDragOver,setIsDragOver]=useState(false);const categories=[{value:'cours',label:'Cours'},{value:'td',label:'TD'},{value:'tp',label:'TP'},{value:'examen',label:'Examen'}];const allowedFileTypes=['application/pdf','application/msword','application/vnd.openxmlformats-officedocument.wordprocessingml.document','application/vnd.ms-powerpoint','application/vnd.openxmlformats-officedocument.presentationml.presentation'];const maxFileSize=50*1024*1024;// 50MB\nuseEffect(()=>{if(isOpen){fetchNiveaux();if((user===null||user===void 0?void 0:user.role)==='professeur'){fetchProfessorMatieres();}// Set preselected matiere if provided\nif(preselectedMatiereId){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{matiereId:preselectedMatiereId}));fetchPreselectedMatiere(preselectedMatiereId);}}},[isOpen,user,preselectedMatiereId]);useEffect(()=>{if(formData.niveauId){fetchFilieres(formData.niveauId);const niveau=niveaux.find(n=>n.id===formData.niveauId);// For PFE documents, automatically set the semester based on niveau\nif(uploadType==='pfe'){const niveauNom=niveau===null||niveau===void 0?void 0:niveau.nom;let autoSemestreId='';if(niveauNom==='L3'||niveauNom==='3ING'){var _niveau$semestres;// For L3 and 3ING, automatically select S6\nconst s6Semestre=niveau===null||niveau===void 0?void 0:(_niveau$semestres=niveau.semestres)===null||_niveau$semestres===void 0?void 0:_niveau$semestres.find(s=>s.nom==='S6');autoSemestreId=(s6Semestre===null||s6Semestre===void 0?void 0:s6Semestre.id)||'';}else if(niveauNom==='M2'){var _niveau$semestres2;// For M2, automatically select S4\nconst s4Semestre=niveau===null||niveau===void 0?void 0:(_niveau$semestres2=niveau.semestres)===null||_niveau$semestres2===void 0?void 0:_niveau$semestres2.find(s=>s.nom==='S4');autoSemestreId=(s4Semestre===null||s4Semestre===void 0?void 0:s4Semestre.id)||'';}// Automatically set the semester\nsetFormData(prev=>_objectSpread(_objectSpread({},prev),{},{semestreId:autoSemestreId}));setSemestres((niveau===null||niveau===void 0?void 0:niveau.semestres)||[]);}else{setSemestres((niveau===null||niveau===void 0?void 0:niveau.semestres)||[]);}}},[formData.niveauId,niveaux,uploadType]);useEffect(()=>{if(formData.filiereId&&formData.semestreId){fetchMatieres(formData.filiereId,formData.semestreId);}},[formData.filiereId,formData.semestreId]);const fetchNiveaux=async()=>{try{const response=await academicAPI.getNiveaux();setNiveaux(response.data);}catch(error){console.error('Error fetching niveaux:',error);}};const fetchFilieres=async niveauId=>{try{const response=await academicAPI.getFilieres({niveauId});setFilieres(response.data);}catch(error){console.error('Error fetching filieres:',error);}};const fetchMatieres=async(filiereId,semestreId)=>{try{const response=await academicAPI.getMatieres({filiereId,semestreId});setMatieres(response.data);}catch(error){console.error('Error fetching matieres:',error);}};const fetchProfessorMatieres=async()=>{try{if(user!==null&&user!==void 0&&user.id){const response=await academicAPI.getProfesseurMatieres(user.id);setProfessorMatieres(response.data);}}catch(error){console.error('Error fetching professor matieres:',error);}};const fetchPreselectedMatiere=async matiereId=>{try{const response=await academicAPI.getMatiere(matiereId);setPreselectedMatiere(response.data);}catch(error){console.error('Error fetching preselected matiere:',error);}};const validateForm=()=>{const newErrors={};if(!formData.titre.trim()){newErrors.titre='Le titre est requis';}if(!formData.file){newErrors.file='Un fichier est requis';}else{if(!allowedFileTypes.includes(formData.file.type)){newErrors.file='Type de fichier non autorisé. Utilisez PDF, DOC, DOCX, PPT ou PPTX';}if(formData.file.size>maxFileSize){newErrors.file='Le fichier est trop volumineux (max 50MB)';}}if(uploadType==='document'){if(!formData.categorie){newErrors.categorie='La catégorie est requise';}if((user===null||user===void 0?void 0:user.role)==='professeur'){// Check for multiple matiere selection or single matiere (backward compatibility)\nif(!preselectedMatiereId&&formData.selectedMatiereIds.length===0&&!formData.matiereId){newErrors.matiereId='Au moins une matière est requise';}}else{if(!formData.niveauId){newErrors.niveauId='Le niveau est requis';}if(!formData.filiereId){newErrors.filiereId='La filière est requise';}if(!formData.semestreId){newErrors.semestreId='Le semestre est requis';}if(!formData.matiereId){newErrors.matiereId='La matière est requise';}}}else{if(!formData.anneeDiplome||formData.anneeDiplome<2000||formData.anneeDiplome>new Date().getFullYear()){newErrors.anneeDiplome='Année de diplôme invalide';}if(!formData.niveauId){newErrors.niveauId='Le niveau est requis';}if(!formData.filiereId){newErrors.filiereId='La filière est requise';}}setErrors(newErrors);return Object.keys(newErrors).length===0;};const handleSubmit=async e=>{e.preventDefault();if(!validateForm()){return;}setLoading(true);try{const formDataToSend=new FormData();// Common fields\nformDataToSend.append('document',formData.file);formDataToSend.append('titre',formData.titre);if(formData.description){formDataToSend.append('description',formData.description);}if(uploadType==='document'){formDataToSend.append('categorie',formData.categorie);// Handle multiple matieres for professors\nif((user===null||user===void 0?void 0:user.role)==='professeur'){if(preselectedMatiereId){// Use preselected matiere\nformDataToSend.append('matiereId',preselectedMatiereId);}else if(formData.selectedMatiereIds.length>0){// Use multiple selected matieres\nformDataToSend.append('matiereIds',JSON.stringify(formData.selectedMatiereIds));// For file organization, use the first selected matiere\nconst firstMatiere=professorMatieres.find(m=>m.id===formData.selectedMatiereIds[0]);if(firstMatiere){var _firstMatiere$filiere,_firstMatiere$filiere2,_firstMatiere$filiere3,_firstMatiere$semestr;const niveauNom=((_firstMatiere$filiere=firstMatiere.filiere)===null||_firstMatiere$filiere===void 0?void 0:(_firstMatiere$filiere2=_firstMatiere$filiere.niveau)===null||_firstMatiere$filiere2===void 0?void 0:_firstMatiere$filiere2.nom)||'';const filiereNom=((_firstMatiere$filiere3=firstMatiere.filiere)===null||_firstMatiere$filiere3===void 0?void 0:_firstMatiere$filiere3.nom)||'';const semestreNom=((_firstMatiere$semestr=firstMatiere.semestre)===null||_firstMatiere$semestr===void 0?void 0:_firstMatiere$semestr.nom)||'';const matiereNom=firstMatiere.nom||'';formDataToSend.append('niveau',niveauNom);formDataToSend.append('filiere',filiereNom);formDataToSend.append('semestre',semestreNom);formDataToSend.append('matiere',matiereNom);}}else{// Fallback to single matiere (backward compatibility)\nformDataToSend.append('matiereId',formData.matiereId);const matiere=professorMatieres.find(m=>m.id===formData.matiereId);if(matiere){var _matiere$filiere,_matiere$filiere$nive,_matiere$filiere2,_matiere$semestre;const niveauNom=((_matiere$filiere=matiere.filiere)===null||_matiere$filiere===void 0?void 0:(_matiere$filiere$nive=_matiere$filiere.niveau)===null||_matiere$filiere$nive===void 0?void 0:_matiere$filiere$nive.nom)||'';const filiereNom=((_matiere$filiere2=matiere.filiere)===null||_matiere$filiere2===void 0?void 0:_matiere$filiere2.nom)||'';const semestreNom=((_matiere$semestre=matiere.semestre)===null||_matiere$semestre===void 0?void 0:_matiere$semestre.nom)||'';const matiereNom=matiere.nom||'';formDataToSend.append('niveau',niveauNom);formDataToSend.append('filiere',filiereNom);formDataToSend.append('semestre',semestreNom);formDataToSend.append('matiere',matiereNom);}}}else{// For admins, use single matiere selection\nformDataToSend.append('matiereId',formData.matiereId);const matiere=matieres.find(m=>m.id===formData.matiereId);if(!matiere){throw new Error('Matière non trouvée');}const niveau=niveaux.find(n=>n.id===formData.niveauId);const filiere=filieres.find(f=>f.id===formData.filiereId);const semestre=semestres.find(s=>s.id===formData.semestreId);const niveauNom=(niveau===null||niveau===void 0?void 0:niveau.nom)||'';const filiereNom=(filiere===null||filiere===void 0?void 0:filiere.nom)||'';const semestreNom=(semestre===null||semestre===void 0?void 0:semestre.nom)||'';const matiereNom=matiere.nom||'';formDataToSend.append('niveau',niveauNom);formDataToSend.append('filiere',filiereNom);formDataToSend.append('semestre',semestreNom);formDataToSend.append('matiere',matiereNom);}await documentsAPI.uploadDocument(formDataToSend);toast.success('Document ajouté avec succès');}else{// PFE document upload\nconst niveau=niveaux.find(n=>n.id===formData.niveauId);const filiere=filieres.find(f=>f.id===formData.filiereId);const semestre=semestres.find(s=>s.id===formData.semestreId);formDataToSend.append('niveau',(niveau===null||niveau===void 0?void 0:niveau.nom)||'');formDataToSend.append('filiere',(filiere===null||filiere===void 0?void 0:filiere.nom)||'');formDataToSend.append('semestre',(semestre===null||semestre===void 0?void 0:semestre.nom)||'');formDataToSend.append('categorie','pfe');formDataToSend.append('anneeDiplome',formData.anneeDiplome.toString());formDataToSend.append('filiereDiplome',(filiere===null||filiere===void 0?void 0:filiere.nom)||'');formDataToSend.append('titreProjet',formData.titre);if(formData.description){formDataToSend.append('resume',formData.description);}if(formData.motsCles){formDataToSend.append('motsCles',formData.motsCles);}await documentsAPI.uploadPFEDocument(formDataToSend);toast.success('Document PFE ajouté avec succès');}onSuccess();resetForm();}catch(error){var _error$response,_error$response$data;console.error('Error uploading document:',error);toast.error(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||'Erreur lors de l\\'ajout du document');}finally{setLoading(false);}};const resetForm=()=>{setFormData({titre:'',description:'',categorie:'',matiereId:'',selectedMatiereIds:[],niveauId:'',filiereId:'',semestreId:'',anneeDiplome:new Date().getFullYear(),resume:'',motsCles:'',file:null});setErrors({});setUploadType('document');setPreselectedMatiere(null);};const handleClose=()=>{resetForm();onClose();};const handleFileChange=e=>{var _e$target$files;const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(file){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{file}));if(errors.file){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{file:''}));}}};const handleInputChange=(field,value)=>{setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:value}));if(errors[field]){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{[field]:''}));}};const handleDragOver=e=>{e.preventDefault();e.stopPropagation();setIsDragOver(true);};const handleDragLeave=e=>{e.preventDefault();e.stopPropagation();setIsDragOver(false);};const handleDrop=e=>{e.preventDefault();e.stopPropagation();setIsDragOver(false);const files=e.dataTransfer.files;if(files&&files.length>0){const file=files[0];// Validate file type\nif(!allowedFileTypes.includes(file.type)){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{file:'Type de fichier non autorisé. Utilisez PDF, DOC, DOCX, PPT ou PPTX'}));return;}// Validate file size\nif(file.size>maxFileSize){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{file:'Le fichier est trop volumineux (max 50MB)'}));return;}setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{file}));if(errors.file){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{file:''}));}}};const canUploadPFE=(user===null||user===void 0?void 0:user.role)==='admin';// Filter niveaux for PFE documents to only show terminal levels\nconst getFilteredNiveaux=()=>{if(uploadType==='pfe'){return niveaux.filter(niveau=>['L3','3ING','M2'].includes(niveau.nom));}return niveaux;};// New function to handle matiere selection\nconst handleMatiereToggle=matiereId=>{setFormData(prev=>{const isSelected=prev.selectedMatiereIds.includes(matiereId);const newSelectedIds=isSelected?prev.selectedMatiereIds.filter(id=>id!==matiereId):[...prev.selectedMatiereIds,matiereId];return _objectSpread(_objectSpread({},prev),{},{selectedMatiereIds:newSelectedIds});});// Clear error when user makes a selection\nif(errors.matiereId){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{matiereId:''}));}};return/*#__PURE__*/_jsx(AnimatePresence,{children:isOpen&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 z-50 overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0\",children:[/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:\"fixed inset-0 bg-gray-500 bg-opacity-75 z-40\",onClick:handleClose}),/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,scale:0.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:0.95,y:20},className:\"relative inline-block w-full max-w-2xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg z-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"p-2 bg-primary-100 rounded-lg\",children:/*#__PURE__*/_jsx(Upload,{className:\"w-6 h-6 text-primary-600\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Ajouter un document\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Ajoutez un nouveau document \\xE0 la biblioth\\xE8que\"})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleClose,className:\"p-2 text-gray-400 hover:text-gray-600 transition-colors\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),canUploadPFE&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setUploadType('document'),className:\"flex-1 p-4 border-2 rounded-lg transition-colors \".concat(uploadType==='document'?'border-primary-500 bg-primary-50':'border-gray-200 hover:border-gray-300'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2\",children:[/*#__PURE__*/_jsx(BookOpen,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Document acad\\xE9mique\"})]})}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>setUploadType('pfe'),className:\"flex-1 p-4 border-2 rounded-lg transition-colors \".concat(uploadType==='pfe'?'border-primary-500 bg-primary-50':'border-gray-200 hover:border-gray-300'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center space-x-2\",children:[/*#__PURE__*/_jsx(GraduationCap,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"Document PFE\"})]})})]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Fichier *\"}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md transition-colors \".concat(isDragOver?'border-primary-500 bg-primary-50':'border-gray-300 hover:border-gray-400'),onDragOver:handleDragOver,onDragLeave:handleDragLeave,onDrop:handleDrop,children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-1 text-center\",children:[/*#__PURE__*/_jsx(FileText,{className:\"mx-auto h-12 w-12 \".concat(isDragOver?'text-primary-500':'text-gray-400')}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex text-sm text-gray-600\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"relative cursor-pointer bg-white rounded-md font-medium text-primary-600 hover:text-primary-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary-500\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"T\\xE9l\\xE9charger un fichier\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"sr-only\",accept:\".pdf,.doc,.docx,.ppt,.pptx\",onChange:handleFileChange})]}),/*#__PURE__*/_jsx(\"p\",{className:\"pl-1\",children:\"ou glisser-d\\xE9poser\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"PDF, DOC, DOCX, PPT, PPTX jusqu'\\xE0 50MB\"}),formData.file&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-green-600 mt-2\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"inline w-4 h-4 mr-1\"}),formData.file.name]})]})}),errors.file&&/*#__PURE__*/_jsxs(\"p\",{className:\"mt-1 text-sm text-red-600 flex items-center\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-4 h-4 mr-1\"}),errors.file]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:uploadType==='pfe'?'Titre du projet *':'Titre *'}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.titre,onChange:e=>handleInputChange('titre',e.target.value),className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\",placeholder:uploadType==='pfe'?'Titre du projet de fin d\\'études':'Titre du document'}),errors.titre&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.titre})]}),uploadType==='document'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Cat\\xE9gorie *\"}),/*#__PURE__*/_jsxs(\"select\",{value:formData.categorie,onChange:e=>handleInputChange('categorie',e.target.value),className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner une cat\\xE9gorie\"}),categories.map(cat=>/*#__PURE__*/_jsx(\"option\",{value:cat.value,children:cat.label},cat.value))]}),errors.categorie&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.categorie})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:uploadType==='pfe'?'Résumé du projet':'Description'}),/*#__PURE__*/_jsx(\"textarea\",{value:formData.description,onChange:e=>handleInputChange('description',e.target.value),rows:3,className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\",placeholder:uploadType==='pfe'?'Résumé du projet de fin d\\'études (optionnel)':'Description du document (optionnel)'})]}),uploadType==='pfe'&&/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Ann\\xE9e de dipl\\xF4me *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:formData.anneeDiplome,onChange:e=>handleInputChange('anneeDiplome',parseInt(e.target.value)),min:\"2000\",max:new Date().getFullYear(),className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\"}),errors.anneeDiplome&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.anneeDiplome})]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Mots-cl\\xE9s\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:formData.motsCles,onChange:e=>handleInputChange('motsCles',e.target.value),className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\",placeholder:\"Mots-cl\\xE9s s\\xE9par\\xE9s par des virgules\"})]})]}),(user===null||user===void 0?void 0:user.role)==='admin'||uploadType==='pfe'?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-gray-900\",children:\"Organisation acad\\xE9mique *\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 gap-4 \".concat(uploadType==='pfe'?'md:grid-cols-2':'md:grid-cols-3'),children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Niveau *\"}),/*#__PURE__*/_jsxs(\"select\",{value:formData.niveauId,onChange:e=>handleInputChange('niveauId',e.target.value),className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner un niveau\"}),getFilteredNiveaux().map(niveau=>/*#__PURE__*/_jsx(\"option\",{value:niveau.id,children:niveau.nom},niveau.id))]}),errors.niveauId&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.niveauId})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Fili\\xE8re *\"}),/*#__PURE__*/_jsxs(\"select\",{value:formData.filiereId,onChange:e=>handleInputChange('filiereId',e.target.value),disabled:!formData.niveauId,className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 disabled:bg-gray-100\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner une fili\\xE8re\"}),filieres.map(filiere=>/*#__PURE__*/_jsx(\"option\",{value:filiere.id,children:filiere.nom},filiere.id))]}),errors.filiereId&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.filiereId})]}),uploadType==='document'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Semestre *\"}),/*#__PURE__*/_jsxs(\"select\",{value:formData.semestreId,onChange:e=>handleInputChange('semestreId',e.target.value),disabled:!formData.niveauId,className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 disabled:bg-gray-100\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"S\\xE9lectionner un semestre\"}),semestres.map(semestre=>/*#__PURE__*/_jsx(\"option\",{value:semestre.id,children:semestre.nom},semestre.id))]}),errors.semestreId&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.semestreId})]})]}),uploadType==='pfe'&&formData.niveauId&&formData.semestreId&&/*#__PURE__*/_jsx(\"div\",{className:\"p-3 bg-blue-50 border border-blue-200 rounded-md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-full bg-blue-100 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-600 text-xs font-medium\",children:\"i\"})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-blue-800\",children:[\"Semestre automatique: \",/*#__PURE__*/_jsx(\"strong\",{children:(_semestres$find=semestres.find(s=>s.id===formData.semestreId))===null||_semestres$find===void 0?void 0:_semestres$find.nom}),\" (semestre final)\"]})]})}),uploadType==='document'&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Mati\\xE8res *\"}),preselectedMatiereId?/*#__PURE__*/_jsx(\"div\",{className:\"w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900\",children:(()=>{const selectedMatiere=preselectedMatiere||professorMatieres.find(m=>m.id===preselectedMatiereId);return selectedMatiere?\"\".concat(selectedMatiere.nom,\" (\").concat(selectedMatiere.code,\")\"):'Matière sélectionnée';})()}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-3\",children:[professorMatieres.map(matiere=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:formData.selectedMatiereIds.includes(matiere.id),onChange:()=>handleMatiereToggle(matiere.id),className:\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-900\",children:[matiere.nom,\" (\",matiere.code,\")\"]})]},matiere.id)),professorMatieres.length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 text-center py-2\",children:\"Aucune mati\\xE8re assign\\xE9e\"})]}),formData.selectedMatiereIds.length>0&&!preselectedMatiereId&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:formData.selectedMatiereIds.length}),\" mati\\xE8re(s) s\\xE9lectionn\\xE9e(s)\"]})}),errors.matiereId&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.matiereId})]})]}):(user===null||user===void 0?void 0:user.role)==='professeur'&&uploadType==='document'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Mati\\xE8res *\"}),preselectedMatiereId?/*#__PURE__*/_jsx(\"div\",{className:\"w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900\",children:(()=>{const selectedMatiere=professorMatieres.find(m=>m.id===preselectedMatiereId);return selectedMatiere?\"\".concat(selectedMatiere.nom,\" (\").concat(selectedMatiere.code,\")\"):'Matière sélectionnée';})()}):/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-3\",children:[professorMatieres.map(matiere=>/*#__PURE__*/_jsxs(\"label\",{className:\"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:formData.selectedMatiereIds.includes(matiere.id),onChange:()=>handleMatiereToggle(matiere.id),className:\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-900\",children:[matiere.nom,\" (\",matiere.code,\")\"]})]},matiere.id)),professorMatieres.length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500 text-center py-2\",children:\"Aucune mati\\xE8re assign\\xE9e\"})]}),formData.selectedMatiereIds.length>0&&!preselectedMatiereId&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-blue-800\",children:[/*#__PURE__*/_jsx(\"strong\",{children:formData.selectedMatiereIds.length}),\" mati\\xE8re(s) s\\xE9lectionn\\xE9e(s)\"]})}),errors.matiereId&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-red-600\",children:errors.matiereId})]}):null,/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleClose,className:\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\",children:\"Annuler\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\",children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Loader2,{className:\"w-4 h-4 mr-2 animate-spin\"}),\"Ajout en cours...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Upload,{className:\"w-4 h-4 mr-2\"}),\"Ajouter\"]})})]})]})]})]})})});};export default DocumentUploadModal;","map":{"version":3,"names":["React","useState","useEffect","motion","AnimatePresence","X","Upload","FileText","AlertCircle","CheckCircle","Loader2","BookOpen","GraduationCap","useAuth","documentsAPI","academicAPI","toast","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","DocumentUploadModal","_ref","_semestres$find","isOpen","onClose","onSuccess","preselectedMatiereId","user","loading","setLoading","uploadType","setUploadType","niveaux","setNiveaux","filieres","setFilieres","semestres","setSemestres","matieres","setMatieres","professorMatieres","setProfessorMatieres","preselectedMatiere","setPreselectedMatiere","formData","setFormData","titre","description","categorie","matiereId","selectedMatiereIds","niveauId","filiereId","semestreId","anneeDiplome","Date","getFullYear","resume","motsCles","file","errors","setErrors","isDragOver","setIsDragOver","categories","value","label","allowedFileTypes","maxFileSize","fetchNiveaux","role","fetchProfessorMatieres","prev","_objectSpread","fetchPreselectedMatiere","fetchFilieres","niveau","find","n","id","niveauNom","nom","autoSemestreId","_niveau$semestres","s6Semestre","s","_niveau$semestres2","s4Semestre","fetchMatieres","response","getNiveaux","data","error","console","getFilieres","getMatieres","getProfesseurMatieres","getMatiere","validateForm","newErrors","trim","includes","type","size","length","Object","keys","handleSubmit","e","preventDefault","formDataToSend","FormData","append","JSON","stringify","firstMatiere","m","_firstMatiere$filiere","_firstMatiere$filiere2","_firstMatiere$filiere3","_firstMatiere$semestr","filiere","filiereNom","semestreNom","semestre","matiereNom","matiere","_matiere$filiere","_matiere$filiere$nive","_matiere$filiere2","_matiere$semestre","Error","f","uploadDocument","success","toString","uploadPFEDocument","resetForm","_error$response","_error$response$data","message","handleClose","handleFileChange","_e$target$files","target","files","handleInputChange","field","handleDragOver","stopPropagation","handleDragLeave","handleDrop","dataTransfer","canUploadPFE","getFilteredNiveaux","filter","handleMatiereToggle","isSelected","newSelectedIds","children","className","div","initial","opacity","animate","exit","onClick","scale","y","concat","onSubmit","onDragOver","onDragLeave","onDrop","accept","onChange","name","placeholder","map","cat","rows","parseInt","min","max","disabled","selectedMatiere","code","checked"],"sources":["/Users/brahimkhalilkhalef/Projects/ISIArchive/frontend/src/components/forms/DocumentUploadModal.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  X,\n  Upload,\n  FileText,\n  AlertCircle,\n  CheckCircle,\n  Loader2,\n  BookOpen,\n  GraduationCap\n} from 'lucide-react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { documentsAPI, academicAPI } from '../../utils/api';\nimport { CreateDocumentData, CreatePFEDocumentData, Matiere, Filiere, Niveau, Semestre } from '../../types';\nimport toast from 'react-hot-toast';\n\ninterface DocumentUploadModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  preselectedMatiereId?: string;\n}\n\nconst DocumentUploadModal: React.FC<DocumentUploadModalProps> = ({\n  isOpen,\n  onClose,\n  onSuccess,\n  preselectedMatiereId\n}) => {\n  const { user } = useAuth();\n  const [loading, setLoading] = useState(false);\n  const [uploadType, setUploadType] = useState<'document' | 'pfe'>('document');\n  const [niveaux, setNiveaux] = useState<Niveau[]>([]);\n  const [filieres, setFilieres] = useState<Filiere[]>([]);\n  const [semestres, setSemestres] = useState<Semestre[]>([]);\n  const [matieres, setMatieres] = useState<Matiere[]>([]);\n  const [professorMatieres, setProfessorMatieres] = useState<Matiere[]>([]);\n  const [preselectedMatiere, setPreselectedMatiere] = useState<Matiere | null>(null);\n\n  const [formData, setFormData] = useState({\n    titre: '',\n    description: '',\n    categorie: '',\n    matiereId: '',\n    selectedMatiereIds: [] as string[],\n    niveauId: '',\n    filiereId: '',\n    semestreId: '',\n    // PFE specific fields\n    anneeDiplome: new Date().getFullYear(),\n    resume: '',\n    motsCles: '',\n    file: null as File | null\n  });\n\n  const [errors, setErrors] = useState<Record<string, string>>({});\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  const categories = [\n    { value: 'cours', label: 'Cours' },\n    { value: 'td', label: 'TD' },\n    { value: 'tp', label: 'TP' },\n    { value: 'examen', label: 'Examen' }\n  ];\n\n  const allowedFileTypes = [\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\n    'application/vnd.ms-powerpoint',\n    'application/vnd.openxmlformats-officedocument.presentationml.presentation'\n  ];\n\n  const maxFileSize = 50 * 1024 * 1024; // 50MB\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchNiveaux();\n      if (user?.role === 'professeur') {\n        fetchProfessorMatieres();\n      }\n      \n      // Set preselected matiere if provided\n      if (preselectedMatiereId) {\n        setFormData(prev => ({ ...prev, matiereId: preselectedMatiereId }));\n        fetchPreselectedMatiere(preselectedMatiereId);\n      }\n    }\n  }, [isOpen, user, preselectedMatiereId]);\n\n  useEffect(() => {\n    if (formData.niveauId) {\n      fetchFilieres(formData.niveauId);\n      const niveau = niveaux.find(n => n.id === formData.niveauId);\n      \n      // For PFE documents, automatically set the semester based on niveau\n      if (uploadType === 'pfe') {\n        const niveauNom = niveau?.nom;\n        let autoSemestreId = '';\n        \n        if (niveauNom === 'L3' || niveauNom === '3ING') {\n          // For L3 and 3ING, automatically select S6\n          const s6Semestre = niveau?.semestres?.find(s => s.nom === 'S6');\n          autoSemestreId = s6Semestre?.id || '';\n        } else if (niveauNom === 'M2') {\n          // For M2, automatically select S4\n          const s4Semestre = niveau?.semestres?.find(s => s.nom === 'S4');\n          autoSemestreId = s4Semestre?.id || '';\n        }\n        \n        // Automatically set the semester\n        setFormData(prev => ({ ...prev, semestreId: autoSemestreId }));\n        setSemestres(niveau?.semestres || []);\n      } else {\n        setSemestres(niveau?.semestres || []);\n      }\n    }\n  }, [formData.niveauId, niveaux, uploadType]);\n\n  useEffect(() => {\n    if (formData.filiereId && formData.semestreId) {\n      fetchMatieres(formData.filiereId, formData.semestreId);\n    }\n  }, [formData.filiereId, formData.semestreId]);\n\n  const fetchNiveaux = async () => {\n    try {\n      const response = await academicAPI.getNiveaux();\n      setNiveaux(response.data);\n    } catch (error) {\n      console.error('Error fetching niveaux:', error);\n    }\n  };\n\n  const fetchFilieres = async (niveauId: string) => {\n    try {\n      const response = await academicAPI.getFilieres({ niveauId });\n      setFilieres(response.data);\n    } catch (error) {\n      console.error('Error fetching filieres:', error);\n    }\n  };\n\n  const fetchMatieres = async (filiereId: string, semestreId: string) => {\n    try {\n      const response = await academicAPI.getMatieres({ filiereId, semestreId });\n      setMatieres(response.data);\n    } catch (error) {\n      console.error('Error fetching matieres:', error);\n    }\n  };\n\n  const fetchProfessorMatieres = async () => {\n    try {\n      if (user?.id) {\n        const response = await academicAPI.getProfesseurMatieres(user.id);\n        setProfessorMatieres(response.data);\n      }\n    } catch (error) {\n      console.error('Error fetching professor matieres:', error);\n    }\n  };\n\n  const fetchPreselectedMatiere = async (matiereId: string) => {\n    try {\n      const response = await academicAPI.getMatiere(matiereId);\n      setPreselectedMatiere(response.data);\n    } catch (error) {\n      console.error('Error fetching preselected matiere:', error);\n    }\n  };\n\n  const validateForm = () => {\n    const newErrors: Record<string, string> = {};\n\n    if (!formData.titre.trim()) {\n      newErrors.titre = 'Le titre est requis';\n    }\n\n    if (!formData.file) {\n      newErrors.file = 'Un fichier est requis';\n    } else {\n      if (!allowedFileTypes.includes(formData.file.type)) {\n        newErrors.file = 'Type de fichier non autorisé. Utilisez PDF, DOC, DOCX, PPT ou PPTX';\n      }\n      if (formData.file.size > maxFileSize) {\n        newErrors.file = 'Le fichier est trop volumineux (max 50MB)';\n      }\n    }\n\n    if (uploadType === 'document') {\n      if (!formData.categorie) {\n        newErrors.categorie = 'La catégorie est requise';\n      }\n      if (user?.role === 'professeur') {\n        // Check for multiple matiere selection or single matiere (backward compatibility)\n        if (!preselectedMatiereId && formData.selectedMatiereIds.length === 0 && !formData.matiereId) {\n          newErrors.matiereId = 'Au moins une matière est requise';\n        }\n      } else {\n        if (!formData.niveauId) {\n          newErrors.niveauId = 'Le niveau est requis';\n        }\n        if (!formData.filiereId) {\n          newErrors.filiereId = 'La filière est requise';\n        }\n        if (!formData.semestreId) {\n          newErrors.semestreId = 'Le semestre est requis';\n        }\n        if (!formData.matiereId) {\n          newErrors.matiereId = 'La matière est requise';\n        }\n      }\n    } else {\n      if (!formData.anneeDiplome || formData.anneeDiplome < 2000 || formData.anneeDiplome > new Date().getFullYear()) {\n        newErrors.anneeDiplome = 'Année de diplôme invalide';\n      }\n      if (!formData.niveauId) {\n        newErrors.niveauId = 'Le niveau est requis';\n      }\n      if (!formData.filiereId) {\n        newErrors.filiereId = 'La filière est requise';\n      }\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!validateForm()) {\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const formDataToSend = new FormData();\n      \n      // Common fields\n      formDataToSend.append('document', formData.file!);\n      formDataToSend.append('titre', formData.titre);\n      if (formData.description) {\n        formDataToSend.append('description', formData.description);\n      }\n\n      if (uploadType === 'document') {\n        formDataToSend.append('categorie', formData.categorie);\n        \n        // Handle multiple matieres for professors\n        if (user?.role === 'professeur') {\n          if (preselectedMatiereId) {\n            // Use preselected matiere\n            formDataToSend.append('matiereId', preselectedMatiereId);\n          } else if (formData.selectedMatiereIds.length > 0) {\n            // Use multiple selected matieres\n            formDataToSend.append('matiereIds', JSON.stringify(formData.selectedMatiereIds));\n            \n            // For file organization, use the first selected matiere\n            const firstMatiere = professorMatieres.find(m => m.id === formData.selectedMatiereIds[0]);\n            if (firstMatiere) {\n              const niveauNom = firstMatiere.filiere?.niveau?.nom || '';\n              const filiereNom = firstMatiere.filiere?.nom || '';\n              const semestreNom = firstMatiere.semestre?.nom || '';\n              const matiereNom = firstMatiere.nom || '';\n\n              formDataToSend.append('niveau', niveauNom);\n              formDataToSend.append('filiere', filiereNom);\n              formDataToSend.append('semestre', semestreNom);\n              formDataToSend.append('matiere', matiereNom);\n            }\n          } else {\n            // Fallback to single matiere (backward compatibility)\n            formDataToSend.append('matiereId', formData.matiereId);\n            const matiere = professorMatieres.find(m => m.id === formData.matiereId);\n            if (matiere) {\n              const niveauNom = matiere.filiere?.niveau?.nom || '';\n              const filiereNom = matiere.filiere?.nom || '';\n              const semestreNom = matiere.semestre?.nom || '';\n              const matiereNom = matiere.nom || '';\n\n              formDataToSend.append('niveau', niveauNom);\n              formDataToSend.append('filiere', filiereNom);\n              formDataToSend.append('semestre', semestreNom);\n              formDataToSend.append('matiere', matiereNom);\n            }\n          }\n        } else {\n          // For admins, use single matiere selection\n          formDataToSend.append('matiereId', formData.matiereId);\n          \n          const matiere = matieres.find(m => m.id === formData.matiereId);\n          if (!matiere) {\n            throw new Error('Matière non trouvée');\n          }\n\n          const niveau = niveaux.find(n => n.id === formData.niveauId);\n          const filiere = filieres.find(f => f.id === formData.filiereId);\n          const semestre = semestres.find(s => s.id === formData.semestreId);\n\n          const niveauNom = niveau?.nom || '';\n          const filiereNom = filiere?.nom || '';\n          const semestreNom = semestre?.nom || '';\n          const matiereNom = matiere.nom || '';\n\n          formDataToSend.append('niveau', niveauNom);\n          formDataToSend.append('filiere', filiereNom);\n          formDataToSend.append('semestre', semestreNom);\n          formDataToSend.append('matiere', matiereNom);\n        }\n\n        await documentsAPI.uploadDocument(formDataToSend);\n        toast.success('Document ajouté avec succès');\n      } else {\n        // PFE document upload\n        const niveau = niveaux.find(n => n.id === formData.niveauId);\n        const filiere = filieres.find(f => f.id === formData.filiereId);\n        const semestre = semestres.find(s => s.id === formData.semestreId);\n\n        formDataToSend.append('niveau', niveau?.nom || '');\n        formDataToSend.append('filiere', filiere?.nom || '');\n        formDataToSend.append('semestre', semestre?.nom || '');\n        formDataToSend.append('categorie', 'pfe');\n        \n        formDataToSend.append('anneeDiplome', formData.anneeDiplome.toString());\n        formDataToSend.append('filiereDiplome', filiere?.nom || '');\n        formDataToSend.append('titreProjet', formData.titre);\n        if (formData.description) {\n          formDataToSend.append('resume', formData.description);\n        }\n        if (formData.motsCles) {\n          formDataToSend.append('motsCles', formData.motsCles);\n        }\n\n        await documentsAPI.uploadPFEDocument(formDataToSend);\n        toast.success('Document PFE ajouté avec succès');\n      }\n\n      onSuccess();\n      resetForm();\n    } catch (error: any) {\n      console.error('Error uploading document:', error);\n      toast.error(error.response?.data?.message || 'Erreur lors de l\\'ajout du document');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const resetForm = () => {\n    setFormData({\n      titre: '',\n      description: '',\n      categorie: '',\n      matiereId: '',\n      selectedMatiereIds: [],\n      niveauId: '',\n      filiereId: '',\n      semestreId: '',\n      anneeDiplome: new Date().getFullYear(),\n      resume: '',\n      motsCles: '',\n      file: null\n    });\n    setErrors({});\n    setUploadType('document');\n    setPreselectedMatiere(null);\n  };\n\n  const handleClose = () => {\n    resetForm();\n    onClose();\n  };\n\n  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      setFormData(prev => ({ ...prev, file }));\n      if (errors.file) {\n        setErrors(prev => ({ ...prev, file: '' }));\n      }\n    }\n  };\n\n  const handleInputChange = (field: string, value: string | number | string[]) => {\n    setFormData(prev => ({ ...prev, [field]: value }));\n    if (errors[field]) {\n      setErrors(prev => ({ ...prev, [field]: '' }));\n    }\n  };\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragOver(false);\n\n    const files = e.dataTransfer.files;\n    if (files && files.length > 0) {\n      const file = files[0];\n      \n      // Validate file type\n      if (!allowedFileTypes.includes(file.type)) {\n        setErrors(prev => ({ ...prev, file: 'Type de fichier non autorisé. Utilisez PDF, DOC, DOCX, PPT ou PPTX' }));\n        return;\n      }\n      \n      // Validate file size\n      if (file.size > maxFileSize) {\n        setErrors(prev => ({ ...prev, file: 'Le fichier est trop volumineux (max 50MB)' }));\n        return;\n      }\n\n      setFormData(prev => ({ ...prev, file }));\n      if (errors.file) {\n        setErrors(prev => ({ ...prev, file: '' }));\n      }\n    }\n  };\n\n  const canUploadPFE = user?.role === 'admin';\n\n  // Filter niveaux for PFE documents to only show terminal levels\n  const getFilteredNiveaux = () => {\n    if (uploadType === 'pfe') {\n      return niveaux.filter(niveau => ['L3', '3ING', 'M2'].includes(niveau.nom));\n    }\n    return niveaux;\n  };\n\n  // New function to handle matiere selection\n  const handleMatiereToggle = (matiereId: string) => {\n    setFormData(prev => {\n      const isSelected = prev.selectedMatiereIds.includes(matiereId);\n      const newSelectedIds = isSelected\n        ? prev.selectedMatiereIds.filter(id => id !== matiereId)\n        : [...prev.selectedMatiereIds, matiereId];\n      \n      return { ...prev, selectedMatiereIds: newSelectedIds };\n    });\n    \n    // Clear error when user makes a selection\n    if (errors.matiereId) {\n      setErrors(prev => ({ ...prev, matiereId: '' }));\n    }\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <div className=\"fixed inset-0 z-50 overflow-y-auto\">\n          <div className=\"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0\">\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"fixed inset-0 bg-gray-500 bg-opacity-75 z-40\"\n              onClick={handleClose}\n            />\n\n            <motion.div\n              initial={{ opacity: 0, scale: 0.95, y: 20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              exit={{ opacity: 0, scale: 0.95, y: 20 }}\n              className=\"relative inline-block w-full max-w-2xl p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-lg z-50\"\n            >\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"p-2 bg-primary-100 rounded-lg\">\n                    <Upload className=\"w-6 h-6 text-primary-600\" />\n                  </div>\n                  <div>\n                    <h3 className=\"text-lg font-medium text-gray-900\">\n                      Ajouter un document\n                    </h3>\n                    <p className=\"text-sm text-gray-500\">\n                      Ajoutez un nouveau document à la bibliothèque\n                    </p>\n                  </div>\n                </div>\n                <button\n                  onClick={handleClose}\n                  className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n\n              {/* Upload Type Selection */}\n              {canUploadPFE && (\n                <div className=\"mb-6\">\n                  <div className=\"flex space-x-4\">\n                    <button\n                      type=\"button\"\n                      onClick={() => setUploadType('document')}\n                      className={`flex-1 p-4 border-2 rounded-lg transition-colors ${\n                        uploadType === 'document'\n                          ? 'border-primary-500 bg-primary-50'\n                          : 'border-gray-200 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <BookOpen className=\"w-5 h-5\" />\n                        <span className=\"font-medium\">Document académique</span>\n                      </div>\n                    </button>\n                    <button\n                      type=\"button\"\n                      onClick={() => setUploadType('pfe')}\n                      className={`flex-1 p-4 border-2 rounded-lg transition-colors ${\n                        uploadType === 'pfe'\n                          ? 'border-primary-500 bg-primary-50'\n                          : 'border-gray-200 hover:border-gray-300'\n                      }`}\n                    >\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <GraduationCap className=\"w-5 h-5\" />\n                        <span className=\"font-medium\">Document PFE</span>\n                      </div>\n                    </button>\n                  </div>\n                </div>\n              )}\n\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                {/* File Upload */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Fichier *\n                  </label>\n                  <div \n                    className={`mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-md transition-colors ${\n                      isDragOver \n                        ? 'border-primary-500 bg-primary-50' \n                        : 'border-gray-300 hover:border-gray-400'\n                    }`}\n                    onDragOver={handleDragOver}\n                    onDragLeave={handleDragLeave}\n                    onDrop={handleDrop}\n                  >\n                    <div className=\"space-y-1 text-center\">\n                      <FileText className={`mx-auto h-12 w-12 ${isDragOver ? 'text-primary-500' : 'text-gray-400'}`} />\n                      <div className=\"flex text-sm text-gray-600\">\n                        <label className=\"relative cursor-pointer bg-white rounded-md font-medium text-primary-600 hover:text-primary-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary-500\">\n                          <span>Télécharger un fichier</span>\n                          <input\n                            type=\"file\"\n                            className=\"sr-only\"\n                            accept=\".pdf,.doc,.docx,.ppt,.pptx\"\n                            onChange={handleFileChange}\n                          />\n                        </label>\n                        <p className=\"pl-1\">ou glisser-déposer</p>\n                      </div>\n                      <p className=\"text-xs text-gray-500\">\n                        PDF, DOC, DOCX, PPT, PPTX jusqu'à 50MB\n                      </p>\n                      {formData.file && (\n                        <p className=\"text-sm text-green-600 mt-2\">\n                          <CheckCircle className=\"inline w-4 h-4 mr-1\" />\n                          {formData.file.name}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n                  {errors.file && (\n                    <p className=\"mt-1 text-sm text-red-600 flex items-center\">\n                      <AlertCircle className=\"w-4 h-4 mr-1\" />\n                      {errors.file}\n                    </p>\n                  )}\n                </div>\n\n                {/* Basic Information */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      {uploadType === 'pfe' ? 'Titre du projet *' : 'Titre *'}\n                    </label>\n                    <input\n                      type=\"text\"\n                      value={formData.titre}\n                      onChange={(e) => handleInputChange('titre', e.target.value)}\n                      className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\"\n                      placeholder={uploadType === 'pfe' ? 'Titre du projet de fin d\\'études' : 'Titre du document'}\n                    />\n                    {errors.titre && (\n                      <p className=\"mt-1 text-sm text-red-600\">{errors.titre}</p>\n                    )}\n                  </div>\n\n                  {uploadType === 'document' && (\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Catégorie *\n                      </label>\n                      <select\n                        value={formData.categorie}\n                        onChange={(e) => handleInputChange('categorie', e.target.value)}\n                        className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\"\n                      >\n                        <option value=\"\">Sélectionner une catégorie</option>\n                        {categories.map(cat => (\n                          <option key={cat.value} value={cat.value}>{cat.label}</option>\n                        ))}\n                      </select>\n                      {errors.categorie && (\n                        <p className=\"mt-1 text-sm text-red-600\">{errors.categorie}</p>\n                      )}\n                    </div>\n                  )}\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    {uploadType === 'pfe' ? 'Résumé du projet' : 'Description'}\n                  </label>\n                  <textarea\n                    value={formData.description}\n                    onChange={(e) => handleInputChange('description', e.target.value)}\n                    rows={3}\n                    className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\"\n                    placeholder={uploadType === 'pfe' ? 'Résumé du projet de fin d\\'études (optionnel)' : 'Description du document (optionnel)'}\n                  />\n                </div>\n\n                {/* PFE Specific Fields */}\n                {uploadType === 'pfe' && (\n                  <div className=\"space-y-4\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                          Année de diplôme *\n                        </label>\n                        <input\n                          type=\"number\"\n                          value={formData.anneeDiplome}\n                          onChange={(e) => handleInputChange('anneeDiplome', parseInt(e.target.value))}\n                          min=\"2000\"\n                          max={new Date().getFullYear()}\n                          className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\"\n                        />\n                        {errors.anneeDiplome && (\n                          <p className=\"mt-1 text-sm text-red-600\">{errors.anneeDiplome}</p>\n                        )}\n                      </div>\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                        Mots-clés\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={formData.motsCles}\n                        onChange={(e) => handleInputChange('motsCles', e.target.value)}\n                        className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\"\n                        placeholder=\"Mots-clés séparés par des virgules\"\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {/* Academic Structure Selection */}\n                {user?.role === 'admin' || uploadType === 'pfe' ? (\n                  <div className=\"space-y-4\">\n                    <h4 className=\"text-sm font-medium text-gray-900\">\n                      Organisation académique *\n                    </h4>\n                    \n                    <div className={`grid grid-cols-1 gap-4 ${uploadType === 'pfe' ? 'md:grid-cols-2' : 'md:grid-cols-3'}`}>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                          Niveau *\n                        </label>\n                        <select\n                          value={formData.niveauId}\n                          onChange={(e) => handleInputChange('niveauId', e.target.value)}\n                          className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500\"\n                        >\n                          <option value=\"\">Sélectionner un niveau</option>\n                          {getFilteredNiveaux().map(niveau => (\n                            <option key={niveau.id} value={niveau.id}>{niveau.nom}</option>\n                          ))}\n                        </select>\n                        {errors.niveauId && (\n                          <p className=\"mt-1 text-sm text-red-600\">{errors.niveauId}</p>\n                        )}\n                      </div>\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                          Filière *\n                        </label>\n                        <select\n                          value={formData.filiereId}\n                          onChange={(e) => handleInputChange('filiereId', e.target.value)}\n                          disabled={!formData.niveauId}\n                          className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 disabled:bg-gray-100\"\n                        >\n                          <option value=\"\">Sélectionner une filière</option>\n                          {filieres.map(filiere => (\n                            <option key={filiere.id} value={filiere.id}>{filiere.nom}</option>\n                          ))}\n                        </select>\n                        {errors.filiereId && (\n                          <p className=\"mt-1 text-sm text-red-600\">{errors.filiereId}</p>\n                        )}\n                      </div>\n\n                      {uploadType === 'document' && (\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                            Semestre *\n                          </label>\n                          <select\n                            value={formData.semestreId}\n                            onChange={(e) => handleInputChange('semestreId', e.target.value)}\n                            disabled={!formData.niveauId}\n                            className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 disabled:bg-gray-100\"\n                          >\n                            <option value=\"\">Sélectionner un semestre</option>\n                            {semestres.map(semestre => (\n                              <option key={semestre.id} value={semestre.id}>{semestre.nom}</option>\n                            ))}\n                          </select>\n                          {errors.semestreId && (\n                            <p className=\"mt-1 text-sm text-red-600\">{errors.semestreId}</p>\n                          )}\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Show automatic semester for PFE */}\n                    {uploadType === 'pfe' && formData.niveauId && formData.semestreId && (\n                      <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-md\">\n                        <div className=\"flex items-center space-x-2\">\n                          <div className=\"w-4 h-4 rounded-full bg-blue-100 flex items-center justify-center\">\n                            <span className=\"text-blue-600 text-xs font-medium\">i</span>\n                          </div>\n                          <span className=\"text-sm text-blue-800\">\n                            Semestre automatique: <strong>{semestres.find(s => s.id === formData.semestreId)?.nom}</strong> (semestre final)\n                          </span>\n                        </div>\n                      </div>\n                    )}\n\n                    {uploadType === 'document' && (\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                          Matières *\n                        </label>\n                        {preselectedMatiereId ? (\n                          <div className=\"w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900\">\n                            {(() => {\n                              const selectedMatiere = preselectedMatiere || professorMatieres.find(m => m.id === preselectedMatiereId);\n                              return selectedMatiere ? `${selectedMatiere.nom} (${selectedMatiere.code})` : 'Matière sélectionnée';\n                            })()}\n                          </div>\n                        ) : (\n                          <div className=\"space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-3\">\n                            {professorMatieres.map(matiere => (\n                              <label key={matiere.id} className=\"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded\">\n                                <input\n                                  type=\"checkbox\"\n                                  checked={formData.selectedMatiereIds.includes(matiere.id)}\n                                  onChange={() => handleMatiereToggle(matiere.id)}\n                                  className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"\n                                />\n                                <span className=\"text-sm text-gray-900\">{matiere.nom} ({matiere.code})</span>\n                              </label>\n                            ))}\n                            {professorMatieres.length === 0 && (\n                              <p className=\"text-sm text-gray-500 text-center py-2\">Aucune matière assignée</p>\n                            )}\n                          </div>\n                        )}\n                        {formData.selectedMatiereIds.length > 0 && !preselectedMatiereId && (\n                          <div className=\"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md\">\n                            <p className=\"text-sm text-blue-800\">\n                              <strong>{formData.selectedMatiereIds.length}</strong> matière(s) sélectionnée(s)\n                            </p>\n                          </div>\n                        )}\n                        {errors.matiereId && (\n                          <p className=\"mt-1 text-sm text-red-600\">{errors.matiereId}</p>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                ) : user?.role === 'professeur' && uploadType === 'document' ? (\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Matières *\n                    </label>\n                    {preselectedMatiereId ? (\n                      <div className=\"w-full px-3 py-2 bg-gray-50 border border-gray-300 rounded-md text-gray-900\">\n                        {(() => {\n                          const selectedMatiere = professorMatieres.find(m => m.id === preselectedMatiereId);\n                          return selectedMatiere ? `${selectedMatiere.nom} (${selectedMatiere.code})` : 'Matière sélectionnée';\n                        })()}\n                      </div>\n                    ) : (\n                      <div className=\"space-y-2 max-h-40 overflow-y-auto border border-gray-300 rounded-md p-3\">\n                        {professorMatieres.map(matiere => (\n                          <label key={matiere.id} className=\"flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-1 rounded\">\n                            <input\n                              type=\"checkbox\"\n                              checked={formData.selectedMatiereIds.includes(matiere.id)}\n                              onChange={() => handleMatiereToggle(matiere.id)}\n                              className=\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"\n                            />\n                            <span className=\"text-sm text-gray-900\">{matiere.nom} ({matiere.code})</span>\n                          </label>\n                        ))}\n                        {professorMatieres.length === 0 && (\n                          <p className=\"text-sm text-gray-500 text-center py-2\">Aucune matière assignée</p>\n                        )}\n                      </div>\n                    )}\n                    {formData.selectedMatiereIds.length > 0 && !preselectedMatiereId && (\n                      <div className=\"mt-2 p-2 bg-blue-50 border border-blue-200 rounded-md\">\n                        <p className=\"text-sm text-blue-800\">\n                          <strong>{formData.selectedMatiereIds.length}</strong> matière(s) sélectionnée(s)\n                        </p>\n                      </div>\n                    )}\n                    {errors.matiereId && (\n                      <p className=\"mt-1 text-sm text-red-600\">{errors.matiereId}</p>\n                    )}\n                  </div>\n                ) : null}\n\n                {/* Actions */}\n                <div className=\"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200\">\n                  <button\n                    type=\"button\"\n                    onClick={handleClose}\n                    className=\"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500\"\n                  >\n                    Annuler\n                  </button>\n                  <button\n                    type=\"submit\"\n                    disabled={loading}\n                    className=\"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-primary-600 border border-transparent rounded-md hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed\"\n                  >\n                    {loading ? (\n                      <>\n                        <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />\n                        Ajout en cours...\n                      </>\n                    ) : (\n                      <>\n                        <Upload className=\"w-4 h-4 mr-2\" />\n                        Ajouter\n                      </>\n                    )}\n                  </button>\n                </div>\n              </form>\n            </motion.div>\n          </div>\n        </div>\n      )}\n    </AnimatePresence>\n  );\n};\n\nexport default DocumentUploadModal; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}