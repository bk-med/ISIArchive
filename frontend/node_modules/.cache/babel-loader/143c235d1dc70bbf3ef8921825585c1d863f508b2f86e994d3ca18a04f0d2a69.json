{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{motion,AnimatePresence}from'framer-motion';import{MessageCircle,Send,Edit2,Trash2,Reply,Crown,Shield,Loader2,AlertTriangle,Clock}from'lucide-react';import{useAuth}from'../../contexts/AuthContext';import{documentsAPI,commentsAPI}from'../../utils/api';import toast from'react-hot-toast';import{formatDistanceToNow}from'date-fns';import{fr}from'date-fns/locale';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const CommentItem=_ref=>{let{comment,currentUser,canModerate=false,onReply,onEdit,onDelete,onSubmitReply,replyingTo,submittingReply,depth=0}=_ref;const[replyContent,setReplyContent]=useState('');const[canReplyToComment,setCanReplyToComment]=useState(true);const[replyRestrictionReason,setReplyRestrictionReason]=useState('');const isOwner=comment.userId===currentUser.id;const isProfessor=comment.user.role==='professeur';const isAdmin=comment.user.role==='admin';const canEditOrDelete=isOwner||canModerate;const isReplying=replyingTo===comment.id;// Check reply permissions when component mounts or user role changes\nuseEffect(()=>{const checkReplyPermissions=async()=>{// Professors and admins can always reply\nif(currentUser.role==='professeur'||currentUser.role==='admin'){setCanReplyToComment(true);return;}// Students need permission check\nif(currentUser.role==='etudiant'){try{const response=await commentsAPI.checkReplyPermission(comment.id);setCanReplyToComment(response.data.canReply);setReplyRestrictionReason(response.data.reason||'');}catch(error){console.error('Error checking reply permissions:',error);setCanReplyToComment(false);setReplyRestrictionReason('Erreur lors de la vérification des permissions');}}};checkReplyPermissions();},[comment.id,currentUser.role]);// If comment is deleted, show deletion message\nif(comment.isDeleted){return/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"\".concat(depth>0?\"ml-\".concat(Math.min(depth*8,32),\" pl-4 border-l-2 border-gray-200\"):'',\" mb-4\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 border border-gray-200 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-gray-500\",children:[/*#__PURE__*/_jsx(AlertTriangle,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm italic\",children:[\"Ce commentaire a \\xE9t\\xE9 supprim\\xE9\",comment.deletedBy===comment.userId?\" par l'utilisateur\":\" par un modérateur\",comment.deletedAt&&/*#__PURE__*/_jsxs(\"span\",{className:\"ml-1\",children:[\"il y a \",formatDistanceToNow(new Date(comment.deletedAt),{addSuffix:false,locale:fr})]})]})]})}),comment.replies&&comment.replies.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:comment.replies.map(reply=>/*#__PURE__*/_jsx(CommentItem,{comment:reply,currentUser:currentUser,canModerate:canModerate,onReply:onReply,onEdit:onEdit,onDelete:onDelete,onSubmitReply:onSubmitReply,replyingTo:replyingTo,submittingReply:submittingReply,depth:depth+1},reply.id))})]});}const handleSubmitInlineReply=async e=>{e.preventDefault();if(!replyContent.trim())return;try{await onSubmitReply(comment.id,replyContent);setReplyContent('');}catch(error){console.error('Error submitting reply:',error);}};const handleCancelReply=()=>{onReply('');// Clear the reply state\nsetReplyContent('');};return/*#__PURE__*/_jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"\".concat(depth>0?\"ml-\".concat(Math.min(depth*8,32),\" pl-4 border-l-2 border-gray-300\"):'',\" mb-4\"),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white border rounded-lg p-4 shadow-sm \".concat(isProfessor?'border-blue-200 bg-blue-50/30':isAdmin?'border-yellow-200 bg-yellow-50/30':'border-gray-200',\" \").concat(depth>0?'bg-gray-50/50':''),children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between mb-3\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium \".concat(isProfessor?'bg-blue-500':isAdmin?'bg-yellow-500':'bg-gray-500'),children:/*#__PURE__*/_jsxs(\"span\",{className:\"text-white font-medium text-xs\",children:[(comment.user.prenom||'').charAt(0),(comment.user.nom||'').charAt(0)]})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium text-gray-900\",children:[comment.user.prenom,\" \",comment.user.nom]}),isProfessor&&/*#__PURE__*/_jsx(\"div\",{title:\"Professeur\",children:/*#__PURE__*/_jsx(Shield,{className:\"w-4 h-4 text-blue-600\"})}),isAdmin&&/*#__PURE__*/_jsx(\"div\",{title:\"Administrateur\",children:/*#__PURE__*/_jsx(Crown,{className:\"w-4 h-4 text-yellow-600\"})}),depth>0&&/*#__PURE__*/_jsx(\"span\",{className:\"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full\",children:\"R\\xE9ponse\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-xs text-gray-500\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-3 h-3\"}),/*#__PURE__*/_jsx(\"span\",{children:formatDistanceToNow(new Date(comment.createdAt),{addSuffix:true,locale:fr})}),comment.isEdited&&/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-400 italic\",children:\"(modifi\\xE9)\"})]})]})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"mb-3\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-700 whitespace-pre-wrap leading-relaxed\",children:comment.contenu})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 text-sm\",children:[canReplyToComment?/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onReply(comment.id),className:\"flex items-center gap-1 text-blue-600 hover:text-blue-700 transition-colors\",children:[/*#__PURE__*/_jsx(Reply,{className:\"w-4 h-4\"}),\"R\\xE9pondre\"]}):/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1 text-gray-400\",children:[/*#__PURE__*/_jsx(Reply,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"R\\xE9pondre\"})]}),replyRestrictionReason&&/*#__PURE__*/_jsxs(\"div\",{className:\"group relative\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 rounded-full bg-orange-100 flex items-center justify-center cursor-help\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-orange-600 text-xs\",children:\"!\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10\",children:[replyRestrictionReason,/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800\"})]})]})]}),canEditOrDelete&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onEdit(comment),className:\"flex items-center gap-1 text-gray-600 hover:text-gray-700 transition-colors\",children:[/*#__PURE__*/_jsx(Edit2,{className:\"w-4 h-4\"}),\"Modifier\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>onDelete(comment.id),className:\"flex items-center gap-1 text-red-600 hover:text-red-700 transition-colors\",children:[/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"}),\"Supprimer\"]})]})]})]}),isReplying&&/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:'auto'},exit:{opacity:0,height:0},className:\"mt-3 ml-4 pl-4 border-l-2 border-blue-300\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmitInlineReply,className:\"bg-blue-50 border border-blue-200 rounded-lg p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-blue-700 text-sm mb-3\",children:[/*#__PURE__*/_jsx(Reply,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[\"R\\xE9ponse \\xE0 \",comment.user.prenom,\" \",comment.user.nom]})]}),/*#__PURE__*/_jsx(\"textarea\",{value:replyContent,onChange:e=>setReplyContent(e.target.value),placeholder:\"\\xC9crivez votre r\\xE9ponse...\",className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none mb-3\",rows:3,disabled:submittingReply,autoFocus:true}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",disabled:!replyContent.trim()||submittingReply,className:\"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm\",children:[submittingReply?/*#__PURE__*/_jsx(Loader2,{className:\"w-4 h-4 animate-spin\"}):/*#__PURE__*/_jsx(Send,{className:\"w-4 h-4\"}),submittingReply?'Envoi...':'Répondre']}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleCancelReply,className:\"px-3 py-2 text-sm bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors\",children:\"Annuler\"})]})]})}),comment.replies&&comment.replies.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:comment.replies.map(reply=>/*#__PURE__*/_jsx(CommentItem,{comment:reply,currentUser:currentUser,canModerate:canModerate,onReply:onReply,onEdit:onEdit,onDelete:onDelete,onSubmitReply:onSubmitReply,replyingTo:replyingTo,submittingReply:submittingReply,depth:depth+1},reply.id))})]});};const CommentSection=_ref2=>{let{documentId,className=''}=_ref2;const{user}=useAuth();const[comments,setComments]=useState([]);const[loading,setLoading]=useState(false);const[submitting,setSubmitting]=useState(false);const[newComment,setNewComment]=useState('');const[replyTo,setReplyTo]=useState(null);const[editingComment,setEditingComment]=useState(null);const[editContent,setEditContent]=useState('');const[canModerate,setCanModerate]=useState(false);// Function to recursively count all comments including nested replies\nconst countAllComments=comments=>{let count=0;for(const comment of comments){if(!comment.isDeleted){count+=1;if(comment.replies&&comment.replies.length>0){count+=countAllComments(comment.replies);}}}return count;};const totalCommentCount=countAllComments(comments);const fetchComments=useCallback(async()=>{if(!documentId)return;setLoading(true);try{const response=await documentsAPI.getDocumentComments(documentId);setComments(response.data||[]);setCanModerate(response.canModerate||false);}catch(error){console.error('Error fetching comments:',error);toast.error('Erreur lors du chargement des commentaires');}finally{setLoading(false);}},[documentId]);useEffect(()=>{fetchComments();},[fetchComments]);const handleSubmitComment=async e=>{e.preventDefault();if(!newComment.trim()||!user)return;setSubmitting(true);try{await documentsAPI.createComment(documentId,{contenu:newComment,parentId:undefined// Only top-level comments from main form\n});setNewComment('');await fetchComments();toast.success('Commentaire ajouté avec succès');}catch(error){console.error('Error creating comment:',error);toast.error('Erreur lors de l\\'ajout du commentaire');}finally{setSubmitting(false);}};const handleSubmitInlineReply=async(parentId,content)=>{if(!content.trim()||!user)return;setSubmitting(true);try{await documentsAPI.createComment(documentId,{contenu:content,parentId:parentId});setReplyTo(null);// Clear reply state\nawait fetchComments();toast.success('Réponse ajoutée avec succès');}catch(error){console.error('Error creating reply:',error);toast.error('Erreur lors de l\\'ajout de la réponse');throw error;// Re-throw to handle in component\n}finally{setSubmitting(false);}};const handleEditComment=async comment=>{if(!editContent.trim())return;try{await commentsAPI.updateComment(comment.id,{contenu:editContent});setEditingComment(null);setEditContent('');await fetchComments();toast.success('Commentaire modifié avec succès');}catch(error){console.error('Error updating comment:',error);toast.error('Erreur lors de la modification du commentaire');}};const handleDeleteComment=async commentId=>{if(!window.confirm('Êtes-vous sûr de vouloir supprimer ce commentaire ?')){return;}try{await commentsAPI.deleteComment(commentId);await fetchComments();toast.success('Commentaire supprimé avec succès');}catch(error){console.error('Error deleting comment:',error);toast.error('Erreur lors de la suppression du commentaire');}};const startEdit=comment=>{setEditingComment(comment);setEditContent(comment.contenu);};const cancelEdit=()=>{setEditingComment(null);setEditContent('');};if(!user){return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border p-6 \".concat(className),children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center text-gray-500\",children:[/*#__PURE__*/_jsx(MessageCircle,{className:\"w-12 h-12 mx-auto mb-2 text-gray-300\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Connectez-vous pour voir et ajouter des commentaires\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border \".concat(className),children:/*#__PURE__*/_jsxs(\"div\",{className:\"p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 mb-6\",children:[/*#__PURE__*/_jsx(MessageCircle,{className:\"w-5 h-5 text-gray-600\"}),/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold text-gray-900\",children:[\"Commentaires (\",totalCommentCount,\")\"]})]}),user.role==='etudiant'&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-600 text-sm font-medium\",children:\"i\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-800\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium mb-1\",children:\"R\\xE8gles de conversation :\"}),/*#__PURE__*/_jsxs(\"ul\",{className:\"space-y-1 text-blue-700\",children:[/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Vous pouvez commenter librement sur les documents\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Vous pouvez r\\xE9pondre aux professeurs et administrateurs\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Attendez une r\\xE9ponse du professeur avant de r\\xE9pondre \\xE0 nouveau\"}),/*#__PURE__*/_jsx(\"li\",{children:\"\\u2022 Vous ne pouvez pas r\\xE9pondre aux autres \\xE9tudiants\"})]})]})]})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmitComment,className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(\"textarea\",{value:newComment,onChange:e=>setNewComment(e.target.value),placeholder:\"\\xC9crivez votre commentaire...\",className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none\",rows:3,disabled:submitting})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center gap-2\",children:canModerate&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1 text-sm text-green-600\",children:[/*#__PURE__*/_jsx(Shield,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Mod\\xE9rateur\"})]})}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",disabled:!newComment.trim()||submitting,className:\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\",children:[submitting?/*#__PURE__*/_jsx(Loader2,{className:\"w-4 h-4 animate-spin\"}):/*#__PURE__*/_jsx(Send,{className:\"w-4 h-4\"}),submitting?'Envoi...':'Publier']})]})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center py-8\",children:[/*#__PURE__*/_jsx(Loader2,{className:\"w-6 h-6 animate-spin text-gray-400\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-500\",children:\"Chargement des commentaires...\"})]}):comments.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(MessageCircle,{className:\"w-12 h-12 mx-auto mb-2 text-gray-300\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Aucun commentaire pour le moment\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:\"Soyez le premier \\xE0 commenter !\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-6\",children:/*#__PURE__*/_jsx(AnimatePresence,{children:comments.filter(comment=>!comment.parentId)// Only show top-level comments\n.map(comment=>/*#__PURE__*/_jsx(\"div\",{children:(editingComment===null||editingComment===void 0?void 0:editingComment.id)===comment.id?/*#__PURE__*/_jsx(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:\"bg-gray-50 border border-gray-200 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-sm text-gray-600 mb-2\",children:[/*#__PURE__*/_jsx(Edit2,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Modification du commentaire\"})]}),/*#__PURE__*/_jsx(\"textarea\",{value:editContent,onChange:e=>setEditContent(e.target.value),className:\"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none\",rows:3,placeholder:\"Modifiez votre commentaire...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleEditComment(comment),disabled:!editContent.trim(),className:\"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\",children:\"Sauvegarder\"}),/*#__PURE__*/_jsx(\"button\",{onClick:cancelEdit,className:\"px-3 py-1 text-sm bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors\",children:\"Annuler\"})]})]})}):/*#__PURE__*/_jsx(CommentItem,{comment:comment,currentUser:user,canModerate:canModerate,onReply:parentId=>setReplyTo(parentId),onEdit:comment=>startEdit(comment),onDelete:commentId=>handleDeleteComment(commentId),onSubmitReply:handleSubmitInlineReply,replyingTo:replyTo,submittingReply:submitting})},comment.id))})})]})});};export default CommentSection;","map":{"version":3,"names":["React","useState","useEffect","useCallback","motion","AnimatePresence","MessageCircle","Send","Edit2","Trash2","Reply","Crown","Shield","Loader2","AlertTriangle","Clock","useAuth","documentsAPI","commentsAPI","toast","formatDistanceToNow","fr","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CommentItem","_ref","comment","currentUser","canModerate","onReply","onEdit","onDelete","onSubmitReply","replyingTo","submittingReply","depth","replyContent","setReplyContent","canReplyToComment","setCanReplyToComment","replyRestrictionReason","setReplyRestrictionReason","isOwner","userId","id","isProfessor","user","role","isAdmin","canEditOrDelete","isReplying","checkReplyPermissions","response","checkReplyPermission","data","canReply","reason","error","console","isDeleted","div","initial","opacity","y","animate","className","concat","Math","min","children","deletedBy","deletedAt","Date","addSuffix","locale","replies","length","map","reply","handleSubmitInlineReply","e","preventDefault","trim","handleCancelReply","prenom","charAt","nom","title","createdAt","isEdited","contenu","onClick","height","exit","onSubmit","value","onChange","target","placeholder","rows","disabled","autoFocus","type","CommentSection","_ref2","documentId","comments","setComments","loading","setLoading","submitting","setSubmitting","newComment","setNewComment","replyTo","setReplyTo","editingComment","setEditingComment","editContent","setEditContent","setCanModerate","countAllComments","count","totalCommentCount","fetchComments","getDocumentComments","handleSubmitComment","createComment","parentId","undefined","success","content","handleEditComment","updateComment","handleDeleteComment","commentId","window","confirm","deleteComment","startEdit","cancelEdit","filter"],"sources":["/Users/brahimkhalilkhalef/Projects/ISIArchive/frontend/src/components/ui/CommentSection.tsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  MessageCircle,\n  Send,\n  Edit2,\n  Trash2,\n  Reply,\n  Crown,\n  Shield,\n  Loader2,\n  AlertTriangle,\n  Clock\n} from 'lucide-react';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { documentsAPI, commentsAPI } from '../../utils/api';\nimport { Comment, User } from '../../types';\nimport toast from 'react-hot-toast';\nimport { formatDistanceToNow } from 'date-fns';\nimport { fr } from 'date-fns/locale';\n\ninterface CommentSectionProps {\n  documentId: string;\n  className?: string;\n}\n\ninterface CommentItemProps {\n  comment: Comment;\n  currentUser: User;\n  canModerate?: boolean;\n  onReply: (parentId: string) => void;\n  onEdit: (comment: Comment) => void;\n  onDelete: (commentId: string) => void;\n  onSubmitReply: (parentId: string, content: string) => Promise<void>;\n  replyingTo: string | null;\n  submittingReply: boolean;\n  depth?: number;\n}\n\nconst CommentItem: React.FC<CommentItemProps> = ({\n  comment,\n  currentUser,\n  canModerate = false,\n  onReply,\n  onEdit,\n  onDelete,\n  onSubmitReply,\n  replyingTo,\n  submittingReply,\n  depth = 0\n}) => {\n  const [replyContent, setReplyContent] = useState('');\n  const [canReplyToComment, setCanReplyToComment] = useState(true);\n  const [replyRestrictionReason, setReplyRestrictionReason] = useState<string>('');\n  \n  const isOwner = comment.userId === currentUser.id;\n  const isProfessor = comment.user.role === 'professeur';\n  const isAdmin = comment.user.role === 'admin';\n  const canEditOrDelete = isOwner || canModerate;\n  const isReplying = replyingTo === comment.id;\n\n  // Check reply permissions when component mounts or user role changes\n  useEffect(() => {\n    const checkReplyPermissions = async () => {\n      // Professors and admins can always reply\n      if (currentUser.role === 'professeur' || currentUser.role === 'admin') {\n        setCanReplyToComment(true);\n        return;\n      }\n\n      // Students need permission check\n      if (currentUser.role === 'etudiant') {\n        try {\n          const response = await commentsAPI.checkReplyPermission(comment.id);\n          setCanReplyToComment(response.data.canReply);\n          setReplyRestrictionReason(response.data.reason || '');\n        } catch (error) {\n          console.error('Error checking reply permissions:', error);\n          setCanReplyToComment(false);\n          setReplyRestrictionReason('Erreur lors de la vérification des permissions');\n        }\n      }\n    };\n\n    checkReplyPermissions();\n  }, [comment.id, currentUser.role]);\n\n  // If comment is deleted, show deletion message\n  if (comment.isDeleted) {\n    return (\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className={`${depth > 0 ? `ml-${Math.min(depth * 8, 32)} pl-4 border-l-2 border-gray-200` : ''} mb-4`}\n      >\n        <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\">\n          <div className=\"flex items-center gap-2 text-gray-500\">\n            <AlertTriangle className=\"w-4 h-4\" />\n            <span className=\"text-sm italic\">\n              Ce commentaire a été supprimé\n              {comment.deletedBy === comment.userId \n                ? \" par l'utilisateur\" \n                : \" par un modérateur\"\n              }\n              {comment.deletedAt && (\n                <span className=\"ml-1\">\n                  il y a {formatDistanceToNow(new Date(comment.deletedAt), { \n                    addSuffix: false, \n                    locale: fr \n                  })}\n                </span>\n              )}\n            </span>\n          </div>\n        </div>\n        \n        {/* Still show replies even if parent is deleted */}\n        {comment.replies && comment.replies.length > 0 && (\n          <div className=\"mt-2\">\n            {comment.replies.map((reply) => (\n              <CommentItem\n                key={reply.id}\n                comment={reply}\n                currentUser={currentUser}\n                canModerate={canModerate}\n                onReply={onReply}\n                onEdit={onEdit}\n                onDelete={onDelete}\n                onSubmitReply={onSubmitReply}\n                replyingTo={replyingTo}\n                submittingReply={submittingReply}\n                depth={depth + 1}\n              />\n            ))}\n          </div>\n        )}\n      </motion.div>\n    );\n  }\n\n  const handleSubmitInlineReply = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!replyContent.trim()) return;\n\n    try {\n      await onSubmitReply(comment.id, replyContent);\n      setReplyContent('');\n    } catch (error) {\n      console.error('Error submitting reply:', error);\n    }\n  };\n\n  const handleCancelReply = () => {\n    onReply(''); // Clear the reply state\n    setReplyContent('');\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className={`${depth > 0 ? `ml-${Math.min(depth * 8, 32)} pl-4 border-l-2 border-gray-300` : ''} mb-4`}\n    >\n      <div className={`bg-white border rounded-lg p-4 shadow-sm ${\n        isProfessor ? 'border-blue-200 bg-blue-50/30' : \n        isAdmin ? 'border-yellow-200 bg-yellow-50/30' : \n        'border-gray-200'\n      } ${depth > 0 ? 'bg-gray-50/50' : ''}`}>\n        {/* Header */}\n        <div className=\"flex items-center justify-between mb-3\">\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex items-center gap-2\">\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium ${\n                isProfessor ? 'bg-blue-500' : \n                isAdmin ? 'bg-yellow-500' : \n                'bg-gray-500'\n              }`}>\n                <span className=\"text-white font-medium text-xs\">\n                  {(comment.user.prenom || '').charAt(0)}{(comment.user.nom || '').charAt(0)}\n                </span>\n              </div>\n              <div>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-medium text-gray-900\">\n                    {comment.user.prenom} {comment.user.nom}\n                  </span>\n                  {isProfessor && (\n                    <div title=\"Professeur\">\n                      <Shield className=\"w-4 h-4 text-blue-600\" />\n                    </div>\n                  )}\n                  {isAdmin && (\n                    <div title=\"Administrateur\">\n                      <Crown className=\"w-4 h-4 text-yellow-600\" />\n                    </div>\n                  )}\n                  {depth > 0 && (\n                    <span className=\"text-xs bg-gray-200 text-gray-600 px-2 py-1 rounded-full\">\n                      Réponse\n                    </span>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-2 text-xs text-gray-500\">\n                  <Clock className=\"w-3 h-3\" />\n                  <span>\n                    {formatDistanceToNow(new Date(comment.createdAt), { \n                      addSuffix: true, \n                      locale: fr \n                    })}\n                  </span>\n                  {comment.isEdited && (\n                    <span className=\"text-gray-400 italic\">(modifié)</span>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"mb-3\">\n          <p className=\"text-gray-700 whitespace-pre-wrap leading-relaxed\">{comment.contenu}</p>\n        </div>\n\n        {/* Actions */}\n        <div className=\"flex items-center gap-3 text-sm\">\n          {canReplyToComment ? (\n            <button\n              onClick={() => onReply(comment.id)}\n              className=\"flex items-center gap-1 text-blue-600 hover:text-blue-700 transition-colors\"\n            >\n              <Reply className=\"w-4 h-4\" />\n              Répondre\n            </button>\n          ) : (\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex items-center gap-1 text-gray-400\">\n                <Reply className=\"w-4 h-4\" />\n                <span>Répondre</span>\n              </div>\n              {replyRestrictionReason && (\n                <div className=\"group relative\">\n                  <div className=\"w-4 h-4 rounded-full bg-orange-100 flex items-center justify-center cursor-help\">\n                    <span className=\"text-orange-600 text-xs\">!</span>\n                  </div>\n                  <div className=\"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-800 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10\">\n                    {replyRestrictionReason}\n                    <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 border-4 border-transparent border-t-gray-800\"></div>\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n          \n          {canEditOrDelete && (\n            <>\n              <button\n                onClick={() => onEdit(comment)}\n                className=\"flex items-center gap-1 text-gray-600 hover:text-gray-700 transition-colors\"\n              >\n                <Edit2 className=\"w-4 h-4\" />\n                Modifier\n              </button>\n              \n              <button\n                onClick={() => onDelete(comment.id)}\n                className=\"flex items-center gap-1 text-red-600 hover:text-red-700 transition-colors\"\n              >\n                <Trash2 className=\"w-4 h-4\" />\n                Supprimer\n              </button>\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* Inline Reply Form */}\n      {isReplying && (\n        <motion.div\n          initial={{ opacity: 0, height: 0 }}\n          animate={{ opacity: 1, height: 'auto' }}\n          exit={{ opacity: 0, height: 0 }}\n          className=\"mt-3 ml-4 pl-4 border-l-2 border-blue-300\"\n        >\n          <form onSubmit={handleSubmitInlineReply} className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n            <div className=\"flex items-center gap-2 text-blue-700 text-sm mb-3\">\n              <Reply className=\"w-4 h-4\" />\n              <span className=\"font-medium\">\n                Réponse à {comment.user.prenom} {comment.user.nom}\n              </span>\n            </div>\n            \n            <textarea\n              value={replyContent}\n              onChange={(e) => setReplyContent(e.target.value)}\n              placeholder=\"Écrivez votre réponse...\"\n              className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none mb-3\"\n              rows={3}\n              disabled={submittingReply}\n              autoFocus\n            />\n            \n            <div className=\"flex items-center gap-2\">\n              <button\n                type=\"submit\"\n                disabled={!replyContent.trim() || submittingReply}\n                className=\"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm\"\n              >\n                {submittingReply ? (\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                ) : (\n                  <Send className=\"w-4 h-4\" />\n                )}\n                {submittingReply ? 'Envoi...' : 'Répondre'}\n              </button>\n              \n              <button\n                type=\"button\"\n                onClick={handleCancelReply}\n                className=\"px-3 py-2 text-sm bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors\"\n              >\n                Annuler\n              </button>\n            </div>\n          </form>\n        </motion.div>\n      )}\n\n      {/* Replies */}\n      {comment.replies && comment.replies.length > 0 && (\n        <div className=\"mt-2\">\n          {comment.replies.map((reply) => (\n            <CommentItem\n              key={reply.id}\n              comment={reply}\n              currentUser={currentUser}\n              canModerate={canModerate}\n              onReply={onReply}\n              onEdit={onEdit}\n              onDelete={onDelete}\n              onSubmitReply={onSubmitReply}\n              replyingTo={replyingTo}\n              submittingReply={submittingReply}\n              depth={depth + 1}\n            />\n          ))}\n        </div>\n      )}\n    </motion.div>\n  );\n};\n\nconst CommentSection: React.FC<CommentSectionProps> = ({\n  documentId,\n  className = ''\n}) => {\n  const { user } = useAuth();\n  const [comments, setComments] = useState<Comment[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const [newComment, setNewComment] = useState('');\n  const [replyTo, setReplyTo] = useState<string | null>(null);\n  const [editingComment, setEditingComment] = useState<Comment | null>(null);\n  const [editContent, setEditContent] = useState('');\n  const [canModerate, setCanModerate] = useState(false);\n\n  // Function to recursively count all comments including nested replies\n  const countAllComments = (comments: Comment[]): number => {\n    let count = 0;\n    for (const comment of comments) {\n      if (!comment.isDeleted) {\n        count += 1;\n        if (comment.replies && comment.replies.length > 0) {\n          count += countAllComments(comment.replies);\n        }\n      }\n    }\n    return count;\n  };\n\n  const totalCommentCount = countAllComments(comments);\n\n  const fetchComments = useCallback(async () => {\n    if (!documentId) return;\n    \n    setLoading(true);\n    try {\n      const response = await documentsAPI.getDocumentComments(documentId);\n      setComments(response.data || []);\n      setCanModerate(response.canModerate || false);\n    } catch (error) {\n      console.error('Error fetching comments:', error);\n      toast.error('Erreur lors du chargement des commentaires');\n    } finally {\n      setLoading(false);\n    }\n  }, [documentId]);\n\n  useEffect(() => {\n    fetchComments();\n  }, [fetchComments]);\n\n  const handleSubmitComment = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newComment.trim() || !user) return;\n\n    setSubmitting(true);\n    try {\n      await documentsAPI.createComment(documentId, {\n        contenu: newComment,\n        parentId: undefined // Only top-level comments from main form\n      });\n      \n      setNewComment('');\n      await fetchComments();\n      toast.success('Commentaire ajouté avec succès');\n    } catch (error) {\n      console.error('Error creating comment:', error);\n      toast.error('Erreur lors de l\\'ajout du commentaire');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleSubmitInlineReply = async (parentId: string, content: string) => {\n    if (!content.trim() || !user) return;\n\n    setSubmitting(true);\n    try {\n      await documentsAPI.createComment(documentId, {\n        contenu: content,\n        parentId: parentId\n      });\n      \n      setReplyTo(null); // Clear reply state\n      await fetchComments();\n      toast.success('Réponse ajoutée avec succès');\n    } catch (error) {\n      console.error('Error creating reply:', error);\n      toast.error('Erreur lors de l\\'ajout de la réponse');\n      throw error; // Re-throw to handle in component\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleEditComment = async (comment: Comment) => {\n    if (!editContent.trim()) return;\n\n    try {\n      await commentsAPI.updateComment(comment.id, {\n        contenu: editContent\n      });\n      \n      setEditingComment(null);\n      setEditContent('');\n      await fetchComments();\n      toast.success('Commentaire modifié avec succès');\n    } catch (error) {\n      console.error('Error updating comment:', error);\n      toast.error('Erreur lors de la modification du commentaire');\n    }\n  };\n\n  const handleDeleteComment = async (commentId: string) => {\n    if (!window.confirm('Êtes-vous sûr de vouloir supprimer ce commentaire ?')) {\n      return;\n    }\n\n    try {\n      await commentsAPI.deleteComment(commentId);\n      await fetchComments();\n      toast.success('Commentaire supprimé avec succès');\n    } catch (error) {\n      console.error('Error deleting comment:', error);\n      toast.error('Erreur lors de la suppression du commentaire');\n    }\n  };\n\n  const startEdit = (comment: Comment) => {\n    setEditingComment(comment);\n    setEditContent(comment.contenu);\n  };\n\n  const cancelEdit = () => {\n    setEditingComment(null);\n    setEditContent('');\n  };\n\n  if (!user) {\n    return (\n      <div className={`bg-white rounded-lg shadow-sm border p-6 ${className}`}>\n        <div className=\"text-center text-gray-500\">\n          <MessageCircle className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n          <p>Connectez-vous pour voir et ajouter des commentaires</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`bg-white rounded-lg shadow-sm border ${className}`}>\n      <div className=\"p-6\">\n        <div className=\"flex items-center gap-2 mb-6\">\n          <MessageCircle className=\"w-5 h-5 text-gray-600\" />\n          <h3 className=\"text-lg font-semibold text-gray-900\">\n            Commentaires ({totalCommentCount})\n          </h3>\n        </div>\n\n        {/* Conversation Rules Info for Students */}\n        {user.role === 'etudiant' && (\n          <div className=\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\">\n            <div className=\"flex items-start gap-3\">\n              <div className=\"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 mt-0.5\">\n                <span className=\"text-blue-600 text-sm font-medium\">i</span>\n              </div>\n              <div className=\"text-sm text-blue-800\">\n                <p className=\"font-medium mb-1\">Règles de conversation :</p>\n                <ul className=\"space-y-1 text-blue-700\">\n                  <li>• Vous pouvez commenter librement sur les documents</li>\n                  <li>• Vous pouvez répondre aux professeurs et administrateurs</li>\n                  <li>• Attendez une réponse du professeur avant de répondre à nouveau</li>\n                  <li>• Vous ne pouvez pas répondre aux autres étudiants</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Comment Form */}\n        <form onSubmit={handleSubmitComment} className=\"mb-6\">\n          <div className=\"mb-4\">\n            <textarea\n              value={newComment}\n              onChange={(e) => setNewComment(e.target.value)}\n              placeholder=\"Écrivez votre commentaire...\"\n              className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none\"\n              rows={3}\n              disabled={submitting}\n            />\n          </div>\n          \n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              {canModerate && (\n                <div className=\"flex items-center gap-1 text-sm text-green-600\">\n                  <Shield className=\"w-4 h-4\" />\n                  <span>Modérateur</span>\n                </div>\n              )}\n            </div>\n            \n            <button\n              type=\"submit\"\n              disabled={!newComment.trim() || submitting}\n              className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              {submitting ? (\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n              ) : (\n                <Send className=\"w-4 h-4\" />\n              )}\n              {submitting ? 'Envoi...' : 'Publier'}\n            </button>\n          </div>\n        </form>\n\n        {/* Comments List */}\n        {loading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n            <span className=\"ml-2 text-gray-500\">Chargement des commentaires...</span>\n          </div>\n        ) : comments.length === 0 ? (\n          <div className=\"text-center py-8 text-gray-500\">\n            <MessageCircle className=\"w-12 h-12 mx-auto mb-2 text-gray-300\" />\n            <p>Aucun commentaire pour le moment</p>\n            <p className=\"text-sm\">Soyez le premier à commenter !</p>\n          </div>\n        ) : (\n          <div className=\"space-y-6\">\n            <AnimatePresence>\n              {comments\n                .filter(comment => !comment.parentId) // Only show top-level comments\n                .map((comment) => (\n                  <div key={comment.id}>\n                    {editingComment?.id === comment.id ? (\n                      <motion.div\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        className=\"bg-gray-50 border border-gray-200 rounded-lg p-4\"\n                      >\n                        <div className=\"space-y-3\">\n                          <div className=\"flex items-center gap-2 text-sm text-gray-600 mb-2\">\n                            <Edit2 className=\"w-4 h-4\" />\n                            <span>Modification du commentaire</span>\n                          </div>\n                          <textarea\n                            value={editContent}\n                            onChange={(e) => setEditContent(e.target.value)}\n                            className=\"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 resize-none\"\n                            rows={3}\n                            placeholder=\"Modifiez votre commentaire...\"\n                          />\n                          <div className=\"flex items-center gap-2\">\n                            <button\n                              onClick={() => handleEditComment(comment)}\n                              disabled={!editContent.trim()}\n                              className=\"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                            >\n                              Sauvegarder\n                            </button>\n                            <button\n                              onClick={cancelEdit}\n                              className=\"px-3 py-1 text-sm bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition-colors\"\n                            >\n                              Annuler\n                            </button>\n                          </div>\n                        </div>\n                      </motion.div>\n                    ) : (\n                      <CommentItem\n                        comment={comment}\n                        currentUser={user}\n                        canModerate={canModerate}\n                        onReply={(parentId) => setReplyTo(parentId)}\n                        onEdit={(comment) => startEdit(comment)}\n                        onDelete={(commentId) => handleDeleteComment(commentId)}\n                        onSubmitReply={handleSubmitInlineReply}\n                        replyingTo={replyTo}\n                        submittingReply={submitting}\n                      />\n                    )}\n                  </div>\n                ))}\n            </AnimatePresence>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default CommentSection; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}